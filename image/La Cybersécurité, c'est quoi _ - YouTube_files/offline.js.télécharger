(function(g){var window=this;'use strict';var PIx=function(v){var F=new g.J1("und",new g.lx("Default","und",!0));F.captionTracks=v.captionTracks;return F},JZd=function(v){return new g.UY(function(F,K){var x=v.length,O=[];
if(x)for(var r=function(D,E){x--;O[D]=E;x==0&&F(O)},p=function(D){K(D)},T,I=0;I<v.length;I++)T=v[I],g.iR5(T,g.eM(r,I),p);
else F(O)})},XN=function(v){this.W=v},Pi=function(){XN.apply(this,arguments)},lnp=function(){Pi.apply(this,arguments)},fnU=function(){Pi.apply(this,arguments)},qaM=function(){Pi.apply(this,arguments)},ebd=function(){Pi.apply(this,arguments)},btN=function(){Pi.apply(this,arguments)},yZU=function(){Pi.apply(this,arguments)},o8z=function(){Pi.apply(this,arguments)},tOn=function(){XN.apply(this,arguments)},ukU=function(){Pi.apply(this,arguments)},AZn=function(){Pi.apply(this,arguments)},CIn=function(){Pi.apply(this,
arguments)},zbd=function(){Pi.apply(this,arguments)},HtM=function(){Pi.apply(this,arguments)},GAN=function(){Pi.apply(this,arguments)},s0d=function(){Pi.apply(this,arguments)},cZN=function(){Pi.apply(this,arguments)},Wqz=function(){Pi.apply(this,arguments)},BFp=function(){Pi.apply(this,arguments)},Ztn=function(){Pi.apply(this,arguments)},vSp=function(){Pi.apply(this,arguments)},FAv=function(){XN.apply(this,arguments)},KAA=function(){Pi.apply(this,arguments)},xoN=function(){Pi.apply(this,arguments)},
gSv=function(){Pi.apply(this,arguments)},ORM=function(){Pi.apply(this,arguments)},rvU=function(){Pi.apply(this,arguments)},prM=function(){Pi.apply(this,arguments)},QwA=function(){Pi.apply(this,arguments)},T7h=function(){Pi.apply(this,arguments)},IgX=function(){Pi.apply(this,arguments)},DoX=function(){XN.apply(this,arguments)},ESU=function(){XN.apply(this,arguments)},iRn=function(){XN.apply(this,arguments)},YLU=function(){Pi.apply(this,arguments)},wrN=function(){Pi.apply(this,arguments)},N7N=function(){Pi.apply(this,
arguments)},nSd=function(){Pi.apply(this,arguments)},LAn=function(){Pi.apply(this,arguments)},SLU=function(){Pi.apply(this,arguments)},doh=function(){Pi.apply(this,arguments)},VHz=function(){Pi.apply(this,arguments)},jwU=function(){Pi.apply(this,arguments)},mox=function(){Pi.apply(this,arguments)},huv=function(){Pi.apply(this,arguments)},agX=function(){Pi.apply(this,arguments)},Rup=function(){Pi.apply(this,arguments)},kFv=function(){Pi.apply(this,arguments)},MHn=function(){Pi.apply(this,arguments)},
UoA=function(){Pi.apply(this,arguments)},$op=function(){Pi.apply(this,arguments)},Xrx=function(){Pi.apply(this,arguments)},P$x=function(){Pi.apply(this,arguments)},Jvn=function(){Pi.apply(this,arguments)},lgh=function(){Pi.apply(this,arguments)},fgn=function(){Pi.apply(this,arguments)},qLv=function(){Pi.apply(this,arguments)},euX=function(){Pi.apply(this,arguments)},bRv=function(){Pi.apply(this,arguments)},yvN=function(){Pi.apply(this,arguments)},oSU=function(){Pi.apply(this,arguments)},tHU=function(){Pi.apply(this,
arguments)},uWd=function(){Pi.apply(this,arguments)},AvU=function(){XN.apply(this,arguments)},C$v=function(){Pi.apply(this,arguments)},zuz=function(){Pi.apply(this,arguments)},HRd=function(){Pi.apply(this,arguments)},GFx=function(){Pi.apply(this,arguments)},swA=function(){Pi.apply(this,arguments)},cvU=function(){Pi.apply(this,arguments)},WAh=function(){Pi.apply(this,arguments)},B7h=function(){Pi.apply(this,arguments)},ZRz=function(){Pi.apply(this,arguments)},vu1=function(){Pi.apply(this,arguments)},
FYx=function(){Pi.apply(this,arguments)},KYz=function(){Pi.apply(this,arguments)},xrp=function(){Pi.apply(this,arguments)},gux=function(){Pi.apply(this,arguments)},Oxh=function(){Pi.apply(this,arguments)},rKd=function(){Pi.apply(this,arguments)},p_d=function(){Pi.apply(this,arguments)},QXN=function(){Pi.apply(this,arguments)},TwA=function(){Pi.apply(this,arguments)},IjA=function(){Pi.apply(this,arguments)},Drn=function(){Pi.apply(this,arguments)},Eup=function(){Pi.apply(this,arguments)},ixd=function(){Pi.apply(this,
arguments)},YgU=function(){Pi.apply(this,arguments)},w_1=function(){Pi.apply(this,arguments)},NwU=function(){Pi.apply(this,arguments)},nuX=function(){Pi.apply(this,arguments)},LYX=function(){Pi.apply(this,arguments)},SgX=function(){Pi.apply(this,arguments)},dr1=function(){Pi.apply(this,arguments)},VQn=function(){Pi.apply(this,arguments)},jXx=function(){Pi.apply(this,arguments)},mrU=function(){Pi.apply(this,arguments)},hZd=function(){Pi.apply(this,arguments)},aj1=function(v){v=v.key||v.id;
if(!v)throw Error("Entity key is missing");return v},RZU=function(){if(Jk)return Jk();
var v={};Jk=g.xE("PersistentEntityStoreDb",{nG:(v.EntityStore={TD:1},v.EntityAssociationStore={TD:2},v),shared:!1,upgrade:function(F,K){K(1)&&g.qg(g.$B(F,"EntityStore",{keyPath:"key"}),"entityType","entityType");K(2)&&(F=g.$B(F,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.qg(F,"byParentEntityKey","parentEntityKey"),g.qg(F,"byChildEntityKey","childEntityKey"))},
version:3});return Jk()},klh=function(v){return g.Ch(RZU(),v)},MQv=function(v){return g.Ch((0,g.WNM)(),v)},lo=function(v){this.token=v},fA=function(v,F){F=F===void 0?{}:F;
g.Ye.call(this,g.Bdp[v],Object.assign({},{name:"PESEncoderError",type:v},F));this.type=v;this.level="WARNING";Object.setPrototypeOf(this,fA.prototype)},Urv=function(v){return new fA("WRONG_DATA_TYPE",{h5:v})},$r1=function(v){return v instanceof Error?new fA("UNKNOWN_ENCODE_ERROR",{originalMessage:v.message}):new fA("UNKNOWN_ENCODE_ERROR")},X_N=function(v){return v instanceof Error?new fA("UNKNOWN_DECODE_ERROR",{originalMessage:v.message}):new fA("UNKNOWN_DECODE_ERROR")},PWX=function(v,F){v=v instanceof
fA?v:F(v);
g.U0(v);throw v;},JKU=function(){},ljU=function(v,F,K){try{return v.D(F,K)}catch(x){PWX(x,$r1)}},fjU=function(v){v=(new TextEncoder).encode(v).subarray(0,16);
var F=new Uint8Array(16);F.set(v);return F},qy=function(v){this.W=v},eZp=function(v){var F=qgv[v];
if(F)return F;g.Xt(new g.Ye("Entity model not found.",{entityType:v}))},bxN=function(v,F){this.W=v;
this.L=F;this.D={}},ouX=function(v,F){a:{v=yKx(v.L,F.version);
try{var K=v.L(F.data,F.key);break a}catch(x){PWX(x,X_N)}K=void 0}return K},ek=function(v,F,K){return v.W.objectStore("EntityStore").get(F).then(function(x){if(x){if(K&&x.entityType!==K)throw Error("Incorrect entity type");
return ouX(v,x)}})},bo=function(v,F,K){return K?(K=K.map(function(x){return ek(v,x,F)}),g.mK.all(K)):v.W.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(F)).then(function(x){return x.map(function(O){return ouX(v,O)})})},o3=function(v,F,K){var x=aj1(F),O=yKx(v.L,1),r=Object.assign({},F);
return v.W.objectStore("EntityStore").get(x).then(function(p){if(p){if(p.entityType!==K)throw Error("Incorrect entity type");r.entityMetadata||(p=ouX(v,p),r.entityMetadata=p.entityMetadata)}}).then(function(){var p={key:x,
entityType:K,data:ljU(O,r,x),version:1};return g.mK.all([g.JS(v.W.objectStore("EntityStore"),p),tQA(v,r,K)])}).then(function(){ye(v,x,K);
return x})},uJd=function(v,F,K){F=F.map(function(x){return o3(v,x,K)});
return g.mK.all(F)},tk=function(v,F,K){if(K==null?0:K.My){var x=new Set;
return AKd(v,F,x).then(function(){for(var r=[],p=g.P(x),T=p.next();!T.done;T=p.next())r.push(tk(v,T.value));return g.mK.all(r).then(function(){})})}var O=g.CY(F).entityType;
return g.mK.all([v.W.objectStore("EntityStore").delete(F),CWA(v,F)]).then(function(){ye(v,F,O)})},zZU=function(v,F){return g.op(v.W.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(F)},function(K){return g.mK.all([K.delete(),
CWA(v,K.cursor.primaryKey)]).then(function(){ye(v,K.cursor.primaryKey,F);return g.bD(K)})})},Hxd=function(v,F,K,x){var O=yKx(v.L,1);
return ek(v,F,x).then(function(r){if(r){r=g.Tc(r,K);var p={key:F,entityType:x,data:ljU(O,r,F),version:1};return g.mK.all([g.JS(v.W.objectStore("EntityStore"),p),tQA(v,r,x)])}}).then(function(){ye(v,F,x);
return F})},ye=function(v,F,K){var x=v.D[K];
x||(x=new Set,v.D[K]=x);x.add(F)},Glp=function(v,F,K){var x=aj1(F);
K=eZp(K);if(!K)return g.mK.resolve([]);K=new K(F);v=v.W.objectStore("EntityAssociationStore");F=[];K=g.P(K.L());for(var O=K.next();!O.done;O=K.next())F.push(g.JS(v,{parentEntityKey:x,childEntityKey:O.value}));return g.mK.all(F).then(function(r){return r.map(function(p){return p[1]})})},CWA=function(v,F){return v.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(F))},tQA=function(v,F,K){var x=aj1(F);
return CWA(v,x).then(function(){return Glp(v,F,K)})},AKd=function(v,F,K){if(K.has(F))return g.mK.resolve(void 0);
K.add(F);return sXv(v,F).then(function(x){return v.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(F)).then(function(){return x})}).then(function(x){var O=g.mK.resolve(void 0);
x=g.P(x);for(var r=x.next(),p={};!r.done;p={J3:void 0},r=x.next())p.J3=r.value,O=O.then(function(T){return function(){return AKd(v,T.J3,K)}}(p));
return O}).then(function(){})},sXv=function(v,F){var K=v.W.objectStore("EntityAssociationStore");
return K.index("byParentEntityKey").getAll(IDBKeyRange.only(F)).then(function(x){var O=[];x=g.P(x);for(var r=x.next();!r.done;r=x.next())r=r.value,O.push(K.index("byChildEntityKey").getAll(r.childEntityKey));return g.mK.all(O)}).then(function(x){var O=[];
x=g.P(x);for(var r=x.next();!r.done;r=x.next())r=r.value,r.length===1&&O.push(r[0].childEntityKey);return O})},uo=function(){},cK1=function(){this.W={};
this.W[0]=new uo;if(!g.kH("aes_pes_encoder_killswitch")){var v=this.W;try{var F=g.WJ();var K=fjU(F);var x=new qy(new g.rB(K),new g.pM(K))}catch(O){throw v=O instanceof Error?new fA("KEY_CREATION_FAILED",{originalMessage:O.message}):new fA("KEY_CREATION_FAILED"),g.U0(v),v;}v[1]=x}},yKx=function(v,F){F=F===void 0?0:F;
v=v.W[F];if(!v)throw F=new fA("INVALID_ENCODER_VERSION",{h5:F}),g.U0(F),F;return v},Ak=function(v,F){g.A.call(this);
this.token=v;this.W=F;this.observers=[];v=new g.jM.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.WJ());v.onmessage=this.L.bind(this);this.channel=v},CA=function(v,F,K){var x,O,r,p;
return g.y(function(T){if(T.W==1)return g.e(T,klh(v.token),2);if(T.W!=3)return x=T.L,g.e(T,g.P1(x,["EntityStore","EntityAssociationStore"],F,function(I){O=new bxN(I,v.W);return K(O)}),3);
r=T.L;O&&(p=O.D,Object.keys(p).length>0&&(v.channel.postMessage(p),WYU(v,p)));return T.return(r)})},zR=function(v,F,K){return CA(v,{mode:"readwrite",
X$:!0},function(x){return o3(x,F,K)})},Bwx=function(v,F){return CA(v,{mode:"readwrite",
X$:!0},function(K){return uJd(K,F,"offlineOrchestrationActionWrapperEntity")})},ZxU=function(v,F){return CA(v,{mode:"readwrite",
X$:!0},function(K){return tk(K,F)})},v4z=function(v){return CA(v,{mode:"readwrite",
X$:!0},function(F){return zZU(F,"videoPlaybackPositionEntity")})},Hi=function(v,F,K){return CA(v,{mode:"readonly",
X$:!0},function(x){return ek(x,F,K)})},GR=function(v,F,K){return CA(v,{mode:"readonly",
X$:!0},function(x){return bo(x,F,K)})},WYU=function(v,F){v=g.P(v.observers);
for(var K=v.next();!K.done;K=v.next())K=K.value,K(F)},F9M=function(){var v,F,K;
return g.y(function(x){if(x.W==1)return g.pp(x,2),g.e(x,g.FA(),4);if(x.W!=2){v=x.L;if(!v||!g.BJ()||typeof g.jM.BroadcastChannel==="undefined")return x.return();F=new cK1;return x.return(new Ak(v,F))}K=g.DX(x);K instanceof Error&&g.U0(K);return x.return()})},sC=function(){K9d||(K9d=F9M());
return K9d},xxU=function(v){var F;
v=(F=v.options)==null?void 0:F.persistenceOption;return v==="ENTITY_PERSISTENCE_OPTION_PERSIST"||v==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},g4U=function(v){var F;
return g.y(function(K){return K.W==1?g.e(K,sC(),2):(F=K.L)?g.e(K,CA(F,"readwrite",function(x){for(var O={},r=g.P(v),p=r.next(),T={};!p.done;T={EV:void 0,eX:void 0},p=r.next())T.EV=p.value,T.EV.entityKey&&xxU(T.EV)&&(T.eX=g.hH(T.EV.payload),p=void 0,T.EV.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(p=function(I){return function(){return o3(x,I.EV.payload[I.eX],I.eX)}}(T)),T.EV.type==="ENTITY_MUTATION_TYPE_DELETE"&&(p=function(I){return function(){return tk(x,I.EV.entityKey)}}(T)),T.EV.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(p=function(I){return function(){return Hxd(x,I.EV.entityKey,I.EV.payload[I.eX],I.eX)}}(T)),p&&(O[T.EV.entityKey]=O[T.EV.entityKey]?O[T.EV.entityKey].then(p):p()));
return g.mK.all(Object.values(O))}),0):K.return()})},O_d=function(v){var F;
return g.y(function(K){if(K.W==1){F=v.mutations;if(!F||F.length<=0)return K.return();if(g.YY){var x={type:"ENTITY_LOADED"};F!==void 0&&(x.payload=F);g.YY.dispatch(x)}return g.e(K,g4U(F),2)}F.length=0;g.rd(K)})},rEN=function(v){return v!==void 0},pXd=function(v){var F=g.uK();
F=Object.assign({},F);v=Object.assign({},v);for(var K in F)v[K]?(F[K]!==4&&(F[K]=v[K]),delete v[K]):F[K]!==2&&(F[K]=4);Object.assign(F,v);g.YfG(F);JSON.stringify(F);return F},QVU=function(v){var F,K;
return g.y(function(x){if(x.W==1)return g.e(x,g.FA(),2);if(x.W!=3)return(F=x.L)?g.e(x,g.zT(F),3):x.return();K=x.L;return x.return(g.P1(K,["index","media","captions"],{mode:"readwrite",X$:!0},function(O){var r=IDBKeyRange.bound(v+"|",v+"~");O=[O.objectStore("index").delete(r),O.objectStore("media").delete(r),O.objectStore("captions").delete(r)];return g.mK.all(O).then(function(){})}))})},T5U=function(){var v,F;
return g.y(function(K){if(K.W==1)return g.e(K,g.FA(),2);if(K.W!=3){v=K.L;if(!v)throw g.VE("rvdfd");return g.e(K,g.zT(v),3)}F=K.L;return K.return(g.P1(F,["index","media"],{mode:"readwrite",X$:!0},function(x){var O={};return g.e8(x.objectStore("index"),{},function(r){var p=r.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),T=g.mK.resolve(void 0);if(p){var I=p[1];p=p[2];O[I]=O[I]||{};var D;O[I][p]=g.SfA((D=r.getValue())==null?void 0:D.fmts)}else T=r.delete().then(function(){});
return g.mK.all([g.bD(r),T]).then(function(E){return g.P(E).next().value})}).then(function(){for(var r={},p=g.P(Object.keys(O)),T=p.next();!T.done;T=p.next()){T=T.value;
var I=O[T].v;r[T]=O[T].a&&I?1:2}var D=pXd(r);return g.xjA(x.objectStore("media"),{},function(E){var Y=E.cursor.key.match(g.mZs);Y&&r[Y[1]]||x.objectStore("media").delete(E.cursor.key);return g.GIr(E)}).then(function(){return D})})}))})},I3d=function(v,F){var K,x;
return g.y(function(O){if(O.W==1)return g.e(O,g.FA(),2);if(O.W!=3){K=O.L;if(!K)throw g.VE("wct");return g.e(O,g.zT(K),3)}x=O.L;return g.e(O,g.P1(x,["captions"],{mode:"readwrite",X$:!0},function(r){var p=[];r=r.objectStore("captions");for(var T=0;T<F.length;T++){var I=g.JS(r,F[T],v+"|"+F[T].metadata.vss_id);p.push(I)}return g.mK.all(p)}),0)})},DxN=function(v){var F,K,x;
return g.y(function(O){if(O.W==1)return F=IDBKeyRange.bound(v+"|",v+"~"),g.e(O,g.FA(),2);if(O.W!=3){K=O.L;if(!K)throw g.VE("gactfv");return g.e(O,g.zT(K),3)}x=O.L;return O.return(x.getAll("captions",F))})},E4h=function(v){return g.y(function(F){g.C$(v,0);
return F.return(QVU(v))})},i_h=function(v){return{context:g.B9(),
videoIds:v}},YFM=function(v){return{context:g.B9(),
playlistIds:v}},wX1=function(v){return{context:g.B9(),
offlinePlaylistSyncChecks:v}},N5x=function(){this.W=new Map},L9z=function(){n4p||(n4p=new N5x);
return n4p},SFX=function(v,F){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:v},metadata:F,statusCode:void 0,csn:void 0,can:void 0}},dxA=function(v,F,K){if(!K){var x=x===void 0?!1:x;
K=v.W.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!K||x)K=g.nX(16),v.W.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",K)}v={flowNonce:K,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:F.eventType};F.metadata&&(v.flowMetadata=F.metadata);F.statusCode!==void 0&&(v.flowEventStatus=F.statusCode);F.csn&&(v.csn=F.csn);F.can&&(v.can=F.can);g.wZ("flowEvent",v,void 0)},Vq1=function(v){var F,K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn,Pn,U,FQ,Gh,Ts;
return g.y(function($X){if($X.W==1)return g.e($X,CA(v,{mode:"readonly",X$:!0},function(a){return bo(a,"playbackData").then(function(v5){var mv=v5.map(function(Zc){return Zc.transfer}).filter(function(Zc){return!!Zc}),IZ=v5.map(function(Zc){return Zc.offlineVideoPolicy}).filter(function(Zc){return!!Zc}),cl=v5.filter(function(Zc){return!!Zc.key}).map(function(Zc){return g.zc(g.CY(Zc.key).entityId,"downloadStatusEntity")});
mv=bo(a,"transfer",mv);IZ=bo(a,"offlineVideoPolicy",IZ);cl=bo(a,"downloadStatusEntity",cl);var DF=mv.then(function(Zc){Zc=Zc.reduce(function(xX,MM){(MM==null?0:MM.offlineVideoStreams)&&xX.push.apply(xX,g.l(MM.offlineVideoStreams));return xX},[]).filter(function(xX){return!!xX});
return bo(a,"offlineVideoStreams",Zc)});
return g.mK.all([mv,IZ,DF,cl]).then(function(Zc){var xX=g.P(Zc);Zc=xX.next().value;var MM=xX.next().value;var k=xX.next().value;xX=xX.next().value;return[v5,Zc,MM,k,xX]})})}),2);
if($X.W!=3)return F=$X.L,g.e($X,CA(v,{mode:"readonly",X$:!0},function(a){return bo(a,"mainDownloadsListEntity").then(function(v5){var mv,IZ;return(IZ=(mv=v5[0])==null?void 0:mv.downloads)!=null?IZ:[]})}),3);
K=$X.L;x=g.P(F);O=x.next().value;r=x.next().value;p=x.next().value;T=x.next().value;I=x.next().value;D=O;E=r;Y=p;N=T;w=I;n={};V={};h={};X={};M={};J=[];f=g.P(E);for(u=f.next();!u.done;u=f.next())(t=u.value)&&(n[t.key]=t);g_=g.P(Y);for(F_=g_.next();!F_.done;F_=g_.next())(xe=F_.value)&&(V[xe.key]=xe);QA=g.P(w);for(iU=QA.next();!iU.done;iU=QA.next())(KE=iU.value)&&(h[KE.key]=KE);jU=g.P(N);for(B5=jU.next();!B5.done;B5=jU.next())(QU=B5.value)&&(X[QU.key]=QU);or=g.P(K);for(W5=or.next();!W5.done;W5=or.next())qQ=
W5.value,Wn=void 0,M[(Wn=qQ.videoItem)!=null?Wn:""]=!0,qQ.videoItem&&(U=Pn=void 0,FQ=(U=(Pn=g.CY(qQ.videoItem))==null?void 0:Pn.entityId)!=null?U:"",J.push({externalVideoId:FQ}));Gh=D.filter(function(a){if(!a||!a.key||!a.offlineVideoPolicy)return!1;a=g.CY(a.key).entityId;a=g.zc(a,"downloadStatusEntity");var v5;return!(a&&((v5=h[a])==null?void 0:v5.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Ts=Gh.map(function(a){var v5=n[a.transfer],mv=[];if(v5==null?0:v5.offlineVideoStreams)for(var IZ=g.P(v5.offlineVideoStreams),cl=IZ.next();!cl.done;cl=IZ.next())(cl=X[cl.value])&&mv.push(cl);IZ=V[a.offlineVideoPolicy];cl=M;var DF=a==null?void 0:a.playerResponseTimestamp,Zc=g.CY(IZ.key).entityId;a=g.zc(Zc,"mainVideoEntity");if(IZ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var xX="OFFLINE_VIDEO_STATE_DISABLED";IZ.expirationTimestamp&&Number(IZ.expirationTimestamp)<Date.now()/1E3&&(xX="OFFLINE_VIDEO_STATE_EXPIRED")}else if(IZ.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")xX="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(v5==null?void 0:v5.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":xX="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":xX="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":xX="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":xX="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":xX="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":xX="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:xX="OFFLINE_VIDEO_STATE_UNKNOWN"}if(xX==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(v5==null?void 0:v5.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":xX="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":xX="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":xX=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Zc={id:Zc,videoState:xX};if(v5==null?0:v5.cotn)Zc.cotn=v5.cotn;if(v5==null?0:v5.maximumDownloadQuality)Zc.selectedVideoQuality=v5==null?void 0:v5.maximumDownloadQuality;if(v5==null?0:v5.lastProgressTimeMs)Zc.lastProgressTimeMs=v5.lastProgressTimeMs;DF&&(Zc.playerResponseSavedTimeMs=String(Number(DF)*1E3));v5=String;DF=0;mv=g.P(mv);for(xX=mv.next();!xX.done;xX=mv.next())if(xX=xX.value,xX.streamsProgress){xX=g.P(xX.streamsProgress);for(var MM=xX.next();!MM.done;MM=
xX.next()){var k=void 0;DF+=Number((k=MM.value.numBytesDownloaded)!=null?k:0)}}Zc.downloadedBytes=v5(DF);Zc.selectedOfflineMode=cl[a]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";IZ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Zc.offlinePlaybackDisabledReason=IZ.offlinePlaybackDisabledReason);return Zc});
return $X.return({offlineVideos:Ts,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:J}}})})},jVX=function(){this.locks=navigator.locks},mxU=function(){try{var v=g.Rx("ytglobal.locks_");
if(v)return v;var F;if(F=navigator){var K=navigator;F="locks"in K&&!!K.locks}if(F)return g.jM.localStorage&&g.jM.localStorage.getItem("noop"),v=new jVX,g.hA("ytglobal.locks_",v),v}catch(x){}},ci=function(){},hlA=function(){},a3v=function(v){if(v.includes(":"))throw Error("Invalid user cache name: "+v);
return v+":"+g.WJ("CacheStorage get")},RlA=function(){return g.y(function(v){if(Wi!==void 0)return v.return(Wi);
Wi=new Promise(function(F){var K;return g.y(function(x){switch(x.W){case 1:return g.pp(x,2),g.e(x,Bi.open("test-only"),4);case 4:return g.e(x,Bi.delete("test-only"),5);case 5:g.Ix(x,3);break;case 2:if(K=g.DX(x),K instanceof Error&&K.name==="SecurityError")return F(!1),x.return();case 3:F("caches"in window),g.rd(x)}})});
return v.return(Wi)})},Mq1=function(){return g.y(function(v){if(v.W==1)return g.e(v,RlA(),2);
if(!v.L)return v.return(void 0);k5n||(k5n=new hlA);return v.return(k5n)})},ZE=function(v,F,K){g.Xt(new g.Ye("Woffle: "+v,K?{cotn:K}:""));
F instanceof Error&&g.Xt(F)},UxU=function(v){var F;
return g.y(function(K){if(K.W==1)return g.e(K,Vq1(v),2);F=K.L;g.wZ("offlineStateSnapshot",F);g.rd(K)})},vG=function(v){g.A.call(this);
var F=this;this.api=v;this.VR={NDi:function(){return F.W},
pZf:function(){return F.L}};
typeof g.jM.BroadcastChannel!=="undefined"&&(this.W=new g.jM.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.WJ()),this.W.onmessage=this.D.bind(this),this.L=new g.jM.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.WJ()),this.L.onmessage=this.G.bind(this))},Fs=function(v,F){v.api.Vq("onOfflineOperationFailure",F);
var K;(K=v.W)==null||K.postMessage(F)},$xU=function(v,F,K){var x=this;
this.T=v;this.tP=F;this.visibility=K;this.C=this.X=this.j=this.D=this.W=!1;this.G=new g.vu(function(){x.ut()});
this.VR={fY:function(){return x.L},
ut:function(){x.ut()},
hmi:function(){return x.G}};
this.visibility.subscribe("visibilitystatechange",function(){x.x5()})},XXU=function(v){if(!v.D&&!v.W){var F=mxU();
if(F){v.D=!0;var K=g.WJ("OfflineLockManager");F.request("woffle_orchestration_leader:"+K,{},function(){var x,O;return g.y(function(r){switch(r.W){case 1:return g.pp(r,2),v.L=new g.iR,v.W=!0,v.D=!1,g.e(r,v.T(),4);case 4:return g.e(r,v.L.promise,5);case 5:g.Ix(r,0);break;case 2:x=g.DX(r),v.ut(),x instanceof Error&&(O=x,O.args=[{name:"WoLockManagerError",Ki:x.name}],g.U0(O)),g.rd(r)}})})}}},PmM=function(v){v.W&&(v.C=!0,KC(v))},JEh=function(v,F){v.W&&(v.j=F,KC(v))},l3X=function(v,F){v.W&&(v.X=F,KC(v))},
KC=function(v){v.X&&v.j&&v.C&&v.visibility.isBackground()?g.F8(v.G,6E4):v.G.stop()},xm=function(v){var F;
v.offlineDeleteReason=(F=v.offlineDeleteReason)!=null?F:"OFFLINE_DELETE_REASON_UNKNOWN";var K;v.offlineModeType=(K=v.offlineModeType)!=null?K:"OFFLINE_NOW";g.wZ("offlineDeleteEvent",v)},gQ=function(v,F){var K=F.videoId;
var x=F.Eq;F=F.offlineModeType;v.encryptedVideoId=K;v.cotn=x==null?void 0:x.cotn;v.offlineabilityFormatType=x==null?void 0:x.maximumDownloadQuality;var O;v.isRefresh=(O=x==null?void 0:x.isRefresh)!=null?O:!1;var r;v.softErrorCount=(r=x==null?void 0:x.transferRetryCount)!=null?r:0;v.offlineModeType=F!=null?F:"OFFLINE_NOW";(v.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&v.statusType==="UNKNOWN_STATUS_TYPE"||!v.transferStatusType&&!v.statusType)&&g.Xt(Error("Woffle unknown transfer status"));
g.wZ("offlineTransferStatusChanged",v)},f3v=function(v){gQ({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},v)},qFA=function(v,F,K,x){x={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!x};F&&K&&(F=Math.floor(F/1024).toFixed(),K=Math.floor(K/1024).toFixed(),x.alreadyDownloadedKbytes=F,x.totalFetchedKbytes=F,x.totalContentKbytes=K);gQ(x,v)},elU=function(v){gQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},v)},b_x=function(v){gQ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},v)},yEX=function(v){switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Oi=function(v){var F,K,x;
return((x=(F=v.actionMetadata)==null?void 0:(K=F.retryScheduleIntervalsInSeconds)==null?void 0:K.length)!=null?x:0)>0},rQ=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!v.entityKey},pC=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!v.entityKey},QW=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!v.entityKey},o4N=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!v.entityKey},
Tb=function(v,F,K,x,O){O=O===void 0?!1:O;
var r,p,T,I,D,E;return g.y(function(Y){if(Y.W==1)return r=g.zc(v,F),p=g.zc(v,"downloadStatusEntity"),g.e(Y,CA(K,{mode:"readonly",X$:!0},function(N){return g.mK.all([ek(N,r,F),ek(N,p,"downloadStatusEntity")])}),2);
T=Y.L;I=T.length?T[0]:void 0;if(!I)return Y.K5(0);D=tqp;if(E=T.length>1?T[1]:void 0){if(E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!O)return Y.return();E.downloadState=x}else E={key:p,downloadState:x};g.qL(I,D,E);return g.e(Y,CA(K,{mode:"readwrite",X$:!0},function(N){return g.mK.all([o3(N,I,F),o3(N,E,"downloadStatusEntity")])}),0)})},IJ=function(v,F){return v.actionType===F.actionType&&v.entityKey===F.entityKey},Dk=function(v,F){if(v&&v.transferState!=="TRANSFER_STATE_COMPLETE"&&v.transferState!==
"TRANSFER_STATE_FAILED"){var K=g.CY(v.key).entityId;
gQ({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:K,Eq:v,offlineModeType:F})}},Ei=function(v){if(!v||!v.thumbnails)return[];
var F=[];v=g.P(v.thumbnails);for(var K=v.next();!K.done;K=v.next())K=K.value,K.url&&F.push(K.url);return F},uex=function(v,F,K){K=K===void 0?[]:K;
var x,O,r,p,T,I,D,E,Y,N,w,n,V;return g.y(function(h){if(h.W==1)return K.length?g.e(h,GR(v,F),2):h.return([]);x=h.L;O=new Set;r=g.P(x);for(p=r.next();!p.done;p=r.next())if(T=p.value,I=T.id||T.key)D=g.CY(I).entityId,O.add(D);E=[];Y=g.P(K);for(N=Y.next();!N.done;N=Y.next())w=N.value,n=w.offlineVideoData,V=void 0,((V=n)==null?0:V.videoId)&&!O.has(n.videoId)&&E.push(w);return h.return(E)})},AEA=function(v,F,K){return new g.gW(v,{cotn:F,
raw_player_response:K,download_media:!0,start:Infinity,disable_watch_next:!0})},CmA=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},iV=function(v,F,K,x,O,r,p,T,I,D,E){this.entityType=v;
this.actionId=F;this.action=K;this.parentActionId=x;this.rootActionId=O===void 0?F:O;this.childActionIds=r;this.prereqActionId=p;this.postreqActionIds=T;this.hasChildActionFailed=D;this.retryScheduleIndex=0;this.W=E||Date.now();this.retryScheduleIndex=I||0},Ym=function(v){if(!v.key)throw Error("Entity key is required.");
if(!v.actionProto)throw Error("OfflineOrchestrationAction is required.");var F=g.CY(v.key),K=g.CY(v.actionProto.entityKey);return new iV(K.entityType,F.entityId,v.actionProto,v.parentActionId,v.rootActionId,v.childActionIds,v.prereqActionId,v.postreqActionIds,v.retryScheduleIndex,v.hasChildActionFailed,Number(v.enqueueTimeSec)*1E3)},wQ=function(v){return{key:g.zc(v.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:v.action,parentActionId:v.parentActionId,rootActionId:v.rootActionId,childActionIds:v.childActionIds,prereqActionId:v.prereqActionId,postreqActionIds:v.postreqActionIds,retryScheduleIndex:v.retryScheduleIndex,hasChildActionFailed:v.hasChildActionFailed,enqueueTimeSec:(v.W/1E3).toFixed()}},zld=function(){var v;
return g.y(function(F){return F.W==1?g.e(F,Mq1(),2):(v=F.L)?F.return(v.delete("yt-player-local-img")):F.return(!0)})},Nb=function(v){var F,K;
return g.y(function(x){if(x.W==1)return g.e(x,Mq1(),2);if(x.W!=3){F=x.L;if(!F)throw Error("Cache API not supported");return v.length?g.e(x,F.open("yt-player-local-img"),3):x.return()}K=x.L;return g.e(x,Promise.all(v.map(function(O){return K.delete(O)})),0)})},nC=function(v){var F,K;
return g.y(function(x){if(x.W==1)return g.e(x,Mq1(),2);if(x.W!=3){F=x.L;if(!F)throw Error("Cache API not supported");return v.length?g.e(x,F.open("yt-player-local-img"),3):x.return()}K=x.L;return g.e(x,K.addAll(v),0)})},LC=function(v,F,K,x,O){var r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn;
return g.y(function(Pn){switch(Pn.W){case 1:return r=g.zc(v,"mainVideoEntity"),p=g.zc(v,"ytMainChannelEntity"),T=g.zc(v,"transfer"),I=g.zc(v,"videoDownloadContextEntity"),g.e(Pn,CA(F,{mode:"readonly",X$:!0},function(U){return g.mK.all([ek(U,r,"mainVideoEntity"),ek(U,p,"ytMainChannelEntity"),ek(U,T,"transfer"),ek(U,I,"videoDownloadContextEntity"),bo(U,"ytMainChannelEntity"),bo(U,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=Pn.L;E=g.P(D);Y=E.next().value;N=E.next().value;w=E.next().value;n=E.next().value;V=E.next().value;h=E.next().value;X=Y;M=N;J=w;f=n;u=V;t=h;if(!X&&!M){Pn.K5(3);break}g_=X?Ei(X.thumbnail):[];if(!M){F_=[];Pn.K5(4);break}return g.e(Pn,H_M(M,u),5);case 5:F_=Pn.L;case 4:return xe=F_,g.e(Pn,Nb(g_.concat(xe)),3);case 3:QA=[];iU=g.zc(v,"downloadStatusEntity");KE=g.P(t);for(jU=KE.next();!jU.done;jU=KE.next())B5=jU.value,QU=g.CY(B5.key).entityId,or=Ym(B5),W5=g.CY(or.action.entityKey).entityId,QU!==
v&&W5!==v||IJ(K,B5.actionProto)||QA.push(B5.key);return g.e(Pn,CA(F,{mode:"readwrite",X$:!0},function(U){var FQ=QA.map(function(Gh){return tk(U,Gh)});
FQ.push(tk(U,r,{My:!0}));FQ.push(tk(U,iU,{My:!0}));return g.mK.all(FQ)}),7);
case 7:Wn=(qQ=f)==null?void 0:qQ.offlineModeType,O&&(xm(O),O.offlineModeType&&(Wn=O.offlineModeType)),Dk(J,Wn),Fs(x,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.rd(Pn)}})},cEd=function(v,F,K,x){var O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn,Pn,U,FQ,Gh,Ts,$X,a,v5,mv,IZ,cl,DF,Zc,xX,MM,k,m,R;
return g.y(function(q){switch(q.W){case 1:return O=g.zc(v,"mainPlaylistEntity"),r=g.zc(v,"ytMainChannelEntity"),g.e(q,CA(F,{mode:"readonly",X$:!0},function(G){return g.mK.all([ek(G,O,"mainPlaylistEntity"),ek(G,r,"ytMainChannelEntity"),bo(G,"mainPlaylistEntity"),bo(G,"mainDownloadsListEntity"),bo(G,"ytMainChannelEntity"),bo(G,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:p=q.L;T=g.P(p);I=T.next().value;D=T.next().value;E=T.next().value;Y=T.next().value;N=T.next().value;w=T.next().value;n=I;V=D;h=E;X=Y;M=N;J=w;if(!n&&!V){q.K5(3);break}f=n?G5U(n):[];if(!V){u=[];q.K5(4);break}return g.e(q,H_M(V,M),5);case 5:u=q.L;case 4:return t=u,g.e(q,Nb(f.concat(t)),3);case 3:g_=[];F_=new Map;if(!n){q.K5(7);break}return g.e(q,sVn(n,h,X),8);case 8:g_=q.L;xe=g.P(g_);for(QA=xe.next();!QA.done;QA=xe.next())iU=QA.value,F_.set(iU,{videoId:iU,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.e(q,CA(F,{mode:"readonly",X$:!0},function(G){return g.mK.all([bo(G,"transfer"),bo(G,"videoDownloadContextEntity")])}),9);
case 9:KE=q.L;jU=g.P(KE);B5=jU.next().value;QU=jU.next().value;or=B5;W5=QU;qQ=g.P(or);for(Wn=qQ.next();!Wn.done;Wn=qQ.next())Pn=Wn.value,U=g.CY(Pn.key).entityId,(FQ=F_.get(U))&&Pn&&(FQ.cotn=Pn.cotn);Gh=g.P(W5);for(Ts=Gh.next();!Ts.done;Ts=Gh.next())$X=Ts.value,a=g.CY($X.key).entityId,(v5=F_.get(a))&&$X&&(v5.offlineModeType=$X.offlineModeType);case 7:mv=[];IZ=g.P(J);for(cl=IZ.next();!cl.done;cl=IZ.next())DF=cl.value,Zc=g.CY(DF.key).entityId,xX=Ym(DF),Zc!==v&&xX.rootActionId!==v||IJ(K,DF.actionProto)||
mv.push(DF.key);MM=g.zc(v,"mainPlaylistEntity");return g.e(q,CA(F,{mode:"readwrite",X$:!0},function(G){var pE=mv.map(function(W){return tk(G,W)});
pE.push(tk(G,MM,{My:!0}));return g.mK.all(pE)}),10);
case 10:if(!n){q.K5(0);break}g_.reverse();if(!g_){q.K5(0);break}k=g.P(g_);m=k.next();case 13:if(m.done){q.K5(0);break}R=m.value;return g.e(q,LC(R,F,K,x,F_.get(R)),14);case 14:m=k.next(),q.K5(13)}})},B5N=function(v,F,K,x){var O,r,p,T,I,D,E,Y,N;
return g.y(function(w){if(w.W==1)return O=g.zc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),r=new Map,g.e(w,CA(v,{mode:"readwrite",X$:!0},function(n){var V=bo(n,"transfer"),h=bo(n,"offlineOrchestrationActionWrapperEntity"),X=bo(n,"videoDownloadContextEntity"),M=ek(n,O,"mainDownloadsListEntity");return g.mK.all([V,h,X,M]).then(function(J){J=g.P(J);var f=J.next().value;var u=J.next().value;var t=J.next().value;var g_=J.next().value;J=W9n.map(function(xe){return zZU(n,xe)});
u=g.P(u);for(var F_=u.next();!F_.done;F_=u.next())F_=F_.value,IJ(F,F_.actionProto)||J.push(tk(n,F_.key,{My:!0}));g_&&(g_.downloads=[],J.push(o3(n,g_,"mainDownloadsListEntity")));if(t)for(t=g.P(t),g_=t.next();!g_.done;g_=t.next())g_=g_.value,u=g.CY(g_.key).entityId,u=g.zc(u,"transfer"),r.set(u,g_.offlineModeType);return g.mK.all(J).then(function(){return f})})}),2);
p=w.L;T=g.P(p);for(I=T.next();!I.done;I=T.next())D=I.value,Dk(D,r.get(D.key)),E=g.CY(D.key).entityId,Y={videoId:E,offlineDeleteReason:x,cotn:D.cotn,offlineModeType:r.get(D.key)},xm(Y),N=g.zc(E,"mainVideoEntity"),Fs(K,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.e(w,zld(),0)})},G5U=function(v,F){var K=[];
if(v.thumbnailStyleData){v=g.P(v.thumbnailStyleData);for(var x=v.next();!x.done;x=v.next()){var O=void 0,r=void 0,p=void 0;K=K.concat(Ei((O=x.value)==null?void 0:(r=O.value)==null?void 0:(p=r.collageThumbnail)==null?void 0:p.coverThumbnail))}}F=Ei(F);return K.concat(F)},sVn=function(v,F,K){var x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe;
return g.y(function(QA){x=[];O=new Set;if(K.length)for(r=g.P(K),p=r.next();!p.done;p=r.next())if(T=p.value,I=void 0,(I=T.downloads)==null?0:I.length)for(D=g.P(T.downloads),E=D.next();!E.done;E=D.next())Y=E.value,Y.videoItem&&(N=g.CY(Y.videoItem).entityId,O.add(N));if(v.videos){w=g.P(v.videos);for(n=w.next();!n.done;n=w.next())V=n.value,h=JSON.parse(g.CY(V).entityId),h.videoId&&!O.has(h.videoId)&&x.push(h.videoId);X=g.P(F);for(M=X.next();!M.done;M=X.next())if(J=M.value,J.key!==v.key&&(f=J.videos))for(u=
g.P(f),t=u.next();!t.done;t=u.next())g_=t.value,F_=JSON.parse(g.CY(g_).entityId),F_.videoId&&(xe=x.indexOf(F_.videoId),xe!==-1&&x.splice(xe,1))}return QA.return(x)})},H_M=function(v,F){var K,x,O,r,p,T,I,D;
return g.y(function(E){K=Ei(v.avatar);x=g.P(F);for(O=x.next();!O.done;O=x.next())if(r=O.value,r.id!==v.id)for(p=g.P(Ei(r.avatar)),T=p.next();!T.done;T=p.next())I=T.value,D=K.indexOf(I),D!==-1&&K.splice(D,1);return E.return(K)})},Z_x=function(v){var F;
return g.y(function(K){F=g.S(v.frameworkUpdates,S1);return v.frameworkUpdates&&F?g.e(K,O_d(F),0):K.return()})},FsU=function(v){var F;
if((F=v.onResponseReceivedActions)!=null&&F.length){var K;v=(K=g.S(g.S(v.onResponseReceivedActions[0],vIh),g.vXU))==null?void 0:K.actions;if(v!=null&&v.length)return v}},Ksh=function(v){var F,K,x;
return g.y(function(O){if(O.W==1)return v?g.e(O,Hi(v,g.$J,"mainDownloadsListEntity"),2):O.return([]);F=O.L;return((K=F)==null?0:(x=K.downloads)==null?0:x.length)?O.return(F.downloads.map(function(r){var p;return(p=r.videoItem)!=null?p:""})):O.return([])})},gIX=function(v,F){var K;
return g.y(function(x){return x.W==1?g.e(x,xEv(v,F),2):(K=x.L)?g.e(x,CA(v,{mode:"readwrite",X$:!0},function(O){var r=[o3(O,K.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];K.mainDownloadsListEntity&&r.push(o3(O,K.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.mK.all(r)}),0):x.K5(0)})},xEv=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J;
return g.y(function(f){if(f.W==1)return K=g.zc("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.zc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.e(f,CA(v,{mode:"readonly",X$:!0},function(u){return g.mK.all([ek(u,K,"mainDownloadsLibraryEntity"),ek(u,x,"mainDownloadsListEntity")])}),2);
O=f.L;r=g.P(O);p=r.next().value;T=r.next().value;I=p;D=T;I||(I={id:K});E=g.P(F);for(Y=E.next();!Y.done;Y=E.next())if(N=Y.value,N===g.$J){if(I.smartDownloadsList)return f.return();I.smartDownloadsList=N}else if(w=g.CY(N).entityType,n={},w==="mainPlaylistEntity"?n.playlistItem=N:w==="mainVideoEntity"&&(n.videoItem=N),!g.XQ(n)){V=void 0;if((V=D)==null?0:V.downloads){h=!1;X=g.P(D.downloads);for(M=X.next();!M.done;M=X.next())if(J=M.value,J.playlistItem===N||J.videoItem===N){h=!0;break}h||D.downloads.push(n)}else D=
{id:x,downloads:[n]};I.downloadsList=x}return f.return({mainDownloadsLibraryEntity:I,mainDownloadsListEntity:D})})},OGz=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h;
return g.y(function(X){if(X.W==1)return K=g.zc("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.zc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.e(X,CA(v,{mode:"readonly",X$:!0},function(M){return g.mK.all([ek(M,K,"mainDownloadsLibraryEntity"),ek(M,x,"mainDownloadsListEntity"),ek(M,g.$J,"mainDownloadsListEntity")])}),2);
O=X.L;r=g.P(O);p=r.next().value;T=r.next().value;I=r.next().value;D=p;E=T;Y=I;if(!D)return X.K5(0);if(F===g.$J&&((N=Y)==null?0:N.downloads))Y.downloads=[];else if((w=E)==null?0:w.downloads)for(n=g.CY(F).entityType,V=0;V<E.downloads.length;V++)if(h=E.downloads[V],n==="mainVideoEntity"&&h.videoItem===F){E.downloads.splice(V,1);break}else if(n==="mainPlaylistEntity"&&h.playlistItem===F){E.downloads.splice(V,1);break}return g.e(X,CA(v,{mode:"readwrite",X$:!0},function(M){var J=[o3(M,D,"mainDownloadsLibraryEntity")];
E&&J.push(o3(M,E,"mainDownloadsListEntity"));Y&&J.push(o3(M,Y,"mainDownloadsListEntity"));return g.mK.all(J)}),0)})},dQ=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N;
return g.y(function(w){if(w.W==1)return K=g.zc(F,"transfer"),x=g.zc(F,"videoDownloadContextEntity"),g.e(w,CA(v,{mode:"readonly",X$:!0},function(n){return g.mK.all([ek(n,K,"transfer"),ek(n,x,"videoDownloadContextEntity")])}),2);
O=w.L;r=g.P(O);p=r.next().value;T=r.next().value;I=p;D=T;N={videoId:F,cotn:(E=I)==null?void 0:E.cotn,offlineModeType:(Y=D)==null?void 0:Y.offlineModeType};return w.return(N)})},VW=function(v,F,K,x,O){var r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_;
return g.y(function(xe){switch(xe.W){case 1:return r=g.zc(v,"musicTrack"),p=g.zc(v,"transfer"),g.e(xe,CA(F,{mode:"readonly",X$:!0},function(QA){return g.mK.all([ek(QA,r,"musicTrack"),ek(QA,p,"transfer"),bo(QA,"musicTrack"),bo(QA,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=xe.L;I=g.P(T);D=I.next().value;E=I.next().value;Y=I.next().value;N=I.next().value;w=D;n=E;V=Y;h=N;if(!w){xe.K5(3);break}return g.e(xe,rMX(w,V),4);case 4:return X=xe.L,g.e(xe,Nb(X),3);case 3:M=[];J=g.P(h);for(f=J.next();!f.done;f=J.next())u=f.value,t=g.CY(u.key).entityId,g_=Ym(u),F_=g.CY(g_.action.entityKey).entityId,t!==v&&F_!==v||IJ(K,u.actionProto)||M.push(u.key);return g.e(xe,CA(F,{mode:"readwrite",X$:!0},function(QA){var iU=M.map(function(KE){return tk(QA,KE)});
iU.push(tk(QA,r,{My:!0}));return g.mK.all(iU)}),6);
case 6:Dk(n),O&&xm(O),Fs(x,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.rd(xe)}})},j1=function(v,F,K,x,O){var r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn,Pn,U,FQ,Gh,Ts;
return g.y(function($X){switch($X.W){case 1:return r=g.zc(v,F),p=g.zc("music_downloads_library_id","musicDownloadsLibraryEntity"),g.e($X,CA(K,{mode:"readonly",X$:!0},function(a){return g.mK.all([ek(a,r,F),ek(a,p,"musicDownloadsLibraryEntity"),bo(a,F),bo(a,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=$X.L;I=g.P(T);D=I.next().value;E=I.next().value;Y=I.next().value;N=I.next().value;w=D;n=E;V=Y;h=N;if(!w){$X.K5(3);break}return g.e($X,rMX(w,V),4);case 4:return X=$X.L,g.e($X,Nb(X),3);case 3:M=[];J=new Map;if(!w){$X.K5(6);break}return g.e($X,pAp(w,V,n),7);case 7:M=$X.L;f=g.P(M);for(u=f.next();!u.done;u=f.next())t=u.value,g_=g.CY(t).entityId,J.set(g_,{videoId:g_,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.e($X,GR(K,"transfer"),8);case 8:for(F_=$X.L,
xe=g.P(F_),QA=xe.next();!QA.done;QA=xe.next())iU=QA.value,KE=g.CY(iU.key).entityId,(jU=J.get(KE))&&iU&&(jU.cotn=iU.cotn);case 6:B5=[];QU=g.P(h);for(or=QU.next();!or.done;or=QU.next())W5=or.value,qQ=g.CY(W5.key).entityId,Wn=Ym(W5),qQ!==v&&Wn.rootActionId!==v||IJ(x,W5.actionProto)||B5.push(W5.key);Pn=g.zc(v,F);return g.e($X,CA(K,{mode:"readwrite",X$:!0},function(a){var v5=B5.map(function(mv){return tk(a,mv)});
v5.push(tk(a,Pn,{My:!0}));return g.mK.all(v5)}),9);
case 9:if(!w){$X.K5(0);break}M.reverse();if(!M.length){$X.K5(0);break}U=g.P(M);FQ=U.next();case 12:if(FQ.done){$X.K5(0);break}Gh=FQ.value;Ts=g.CY(Gh).entityId;if(!Ts){$X.K5(13);break}return g.e($X,VW(Ts,K,x,O,J.get(Ts)),13);case 13:FQ=U.next(),$X.K5(12)}})},m4=function(v,F,K){var x,O,r,p,T,I,D;
return g.y(function(E){if(E.W==1)return g.e(E,CA(v,{mode:"readwrite",X$:!0},function(Y){var N=bo(Y,"transfer"),w=bo(Y,"offlineOrchestrationActionWrapperEntity");return g.mK.all([N,w]).then(function(n){n=g.P(n);var V=n.next().value;var h=n.next().value;n=Q7X.map(function(f){return zZU(Y,f)});
h=g.P(h);for(var X=h.next();!X.done;X=h.next()){X=X.value;var M=g.CY(X.actionProto.entityKey).entityType==="musicTrack",J=X.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";IJ(F,X.actionProto)||M&&(!M||J)||n.push(tk(Y,X.key,{My:!0}))}return g.mK.all(n).then(function(){return V})})}),2);
x=E.L;O=g.P(x);for(r=O.next();!r.done;r=O.next())p=r.value,Dk(p),T=g.CY(p.key).entityId,I={videoId:T,offlineDeleteReason:void 0,cotn:p.cotn},xm(I),D=g.zc(T,"musicTrack"),Fs(K,{entityKey:D,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.e(E,zld(),0)})},Tvz=function(v){for(var F,K=g.P(v.additionalMetadatas),x=K.next();!x.done;x=K.next())x=x.value,x.offlineMusicVideoData&&(F=x.offlineMusicVideoData);
var O,r,p,T,I;return{id:g.zc(v.videoId,"musicTrack"),videoId:v.videoId,title:v.title,thumbnailDetails:v.thumbnail,lengthMs:String(Number(v.lengthSeconds)*1E3),albumTitle:(O=F)==null?void 0:O.releaseTitle,musicVideoType:(r=F)==null?void 0:r.musicVideoType,contentRating:{explicitType:(p=F)==null?void 0:p.explicitType},artistNames:((T=F)==null?void 0:T.byline)||((I=F)==null?void 0:I.channelName),downloadMetadata:g.zc(v.videoId,"musicTrackDownloadMetadataEntity")}},pAp=function(v,F,K){var x,O,r,p,T,I,
D,E,Y,N,w,n,V,h,X,M,J,f;
return g.y(function(u){x=[];O=new Set;if((r=K)==null?0:(p=r.downloadedTracks)==null?0:p.length)for(T=g.P(K.downloadedTracks),I=T.next();!I.done;I=T.next())D=I.value,O.add(D);if(v.tracks){E=g.P(v.tracks);for(Y=E.next();!Y.done;Y=E.next())N=Y.value,O.has(N)||x.push(N);w=g.P(F);for(n=w.next();!n.done;n=w.next())if(V=n.value,V.id!==v.id&&(h=V.tracks))for(X=g.P(h),M=X.next();!M.done;M=X.next())J=M.value,f=x.indexOf(J),f!==-1&&x.splice(f,1)}return u.return(x)})},rMX=function(v,F){var K,x,O,r,p,T,I,D;
return g.y(function(E){K=Ei(v.thumbnailDetails);x=g.P(F);for(O=x.next();!O.done;O=x.next())if(r=O.value,r.id!==v.id)for(p=g.P(Ei(r.thumbnailDetails)),T=p.next();!T.done;T=p.next())I=T.value,D=K.indexOf(I),D!==-1&&K.splice(D,1);return E.return(K)})},IMX=function(v,F){var K,x,O,r,p,T,I,D,E;
return g.y(function(Y){if(Y.W==1)return K=g.zc("music_downloads_library_id","musicDownloadsLibraryEntity"),g.e(Y,Hi(v,K,"musicDownloadsLibraryEntity"),2);(x=Y.L)||(x={id:K});O=g.CY(F).entityType;O==="musicTrack"?(r=x.downloadedTracks)!=null&&r.includes(F)||(x.downloadedTracks=((p=x.downloadedTracks)!=null?p:[]).concat(F)):O==="musicPlaylist"?(T=x.downloadedPlaylists)!=null&&T.includes(F)||(x.downloadedPlaylists=((I=x.downloadedPlaylists)!=null?I:[]).concat(F)):O!=="musicAlbumRelease"||(D=x.downloadedAlbumReleases)!=
null&&D.includes(F)||(x.downloadedAlbumReleases=((E=x.downloadedAlbumReleases)!=null?E:[]).concat(F));return g.e(Y,zR(v,x,"musicDownloadsLibraryEntity"),0)})},DEz=function(v,F){var K,x,O,r,p,T,I;
return g.y(function(D){if(D.W==1)return K=g.zc("music_downloads_library_id","musicDownloadsLibraryEntity"),g.e(D,Hi(v,K,"musicDownloadsLibraryEntity"),2);x=D.L;if(!x)return D.K5(0);O=g.CY(F).entityType;O==="musicTrack"?r=x.downloadedTracks:O==="musicPlaylist"&&(r=x.downloadedPlaylists);if((p=r)==null?0:p.length)for(T=0;T<r.length;T++)if(I=r[T],I===F){r.splice(T,1);break}return g.e(D,zR(v,x,"musicDownloadsLibraryEntity"),0)})},EIv=function(v){var F=v.videos;
v=[];var K=[];if(F){F=g.P(F);for(var x=F.next();!x.done;x=F.next()){var O=x.value.offlineVideoData.videoId;x=g.zc(O,"musicTrack");O=g.zc(O,"musicTrackDownloadMetadataEntity");v.push(x);K.push(O)}}return{Ey:v,AR:K}},hu=function(v,F,K){F={track:Tvz(F)};
K&&(F.playlistId=K);if(v=g.S(v.actionMetadata,iGU))F.maximumDownloadQuality=v.maximumDownloadQuality;return{musicTrackEntityActionMetadata:F}},wAA=function(v){var F,K,x,O,r,p,T,I;
return g.y(function(D){switch(D.W){case 1:return F=g.Wb(),K=i_h(v),x=g.Fn(Y1M),g.pp(D,2),r={fG:!0},g.e(D,g.bE(F,K,x,void 0,r),4);case 4:O=D.L;g.Ix(D,3);break;case 2:p=g.DX(D);if(p instanceof g.GE)throw T="GetOffline network manager error: "+p.message,ZE(T,p),Error(T);ZE("GetOffline fetch request error",p);throw Error("GetOffline fetch request error");case 3:I=aJ(O);if(!O)throw ZE("Network request failed"),Error("Network request failed");if(I!==void 0)RJ(I);else if(!O.videos||!O.videos.length)throw ZE("No data"),
Error("No data");return D.return(O.videos.map(function(E){return E.offlineVideoData}))}})},NvX=function(v){var F,K,x,O,r,p,T,I;
return g.y(function(D){switch(D.W){case 1:return F=g.Wb(),K=YFM(v),x=g.Fn(Y1M),g.pp(D,2),r={fG:!0},g.e(D,g.bE(F,K,x,void 0,r),4);case 4:O=D.L;g.Ix(D,3);break;case 2:p=g.DX(D);if(p instanceof g.GE)throw T="GetOffline network manager error for playlist: "+p.message,ZE(T,p),Error(T);ZE("GetOffline fetch request error for playlist",p);throw Error("GetOffline fetch request error for playlist");case 3:I=aJ(O);if(!O)throw ZE("Network request failed for playlist"),Error("Network request failed for playlist");
if(I!==void 0)RJ(I,"playlist");else if(!O.playlists||!O.playlists.length)throw ZE("No data for playlist"),Error("No data for playlist");return D.return(O.playlists.map(function(E){return E.offlinePlaylistData}))}})},LsU=function(v,F,K,x){var O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5;
return g.y(function(qQ){switch(qQ.W){case 1:return g.e(qQ,sC(),2);case 2:O=qQ.L;if(!O)return qQ.return([]);r=[];if((p=x)==null?0:p.length){r=x;qQ.K5(3);break}return g.e(qQ,GR(O,"mainPlaylistEntity"),4);case 4:r=qQ.L;case 3:if(!r.length)return qQ.return([]);T=[];I=Date.now()/1E3;D=g.P(r);E=D.next();case 5:if(E.done)return T.length?g.e(qQ,nIM(T),10):qQ.return([]);Y=E.value;if(!Y.downloadState){N=void 0;qQ.K5(8);break}return g.e(qQ,Hi(O,Y.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:N=
qQ.L;case 8:w=N;n=void 0;h=(V=(n=Y)==null?void 0:n.entityMetadata)&&V.nextAutoRefreshIntervalSeconds?Number(V.nextAutoRefreshIntervalSeconds):NaN;X=Number.isNaN(h)?v:h;J=M=void 0;f=((M=w)==null?0:M.lastSyncedTimestampMillis)?Number((J=w)==null?void 0:J.lastSyncedTimestampMillis)/1E3:0;t=u=void 0;g_=((u=w)==null?0:u.addedTimestampMillis)?Number((t=w)==null?void 0:t.addedTimestampMillis)/1E3:0;if(K||!V||f+X<=I){F_=[];xe=void 0;if((xe=Y.videos)==null?0:xe.length)for(QA=g.P(Y.videos),iU=QA.next();!iU.done;iU=
QA.next())KE=iU.value,jU=JSON.parse(g.CY(KE).entityId),jU.videoId&&F_.push(jU.videoId);B5="0";V&&(QU=void 0,B5=String(Number((QU=V.offlineLastModifiedTimestampSeconds)!=null?QU:0).toFixed()));or={playlistId:Y.playlistId,videoIds:F_,offlineLastModifiedTimestamp:B5,autoSync:F,offlineDateAddedTimestamp:String(g_.toFixed())};T.push(or)}E=D.next();qQ.K5(5);break;case 10:return W5=qQ.L,qQ.return(W5)}})},S11=function(){var v,F,K,x,O;
return g.y(function(r){if(r.W==1)return g.e(r,sC(),2);if(r.W!=3)return(v=r.L)?g.e(r,GR(v,"refresh"),3):r.return(!1);F=r.L;if((K=F[0])==null||!K.refreshTime)return r.return(!1);x=Number(F[0].refreshTime);O=Date.now()/1E3;return r.return(isFinite(x)&&O>=x)})},V9A=function(v,F){var K,x,O;
return g.y(function(r){switch(r.W){case 1:return g.pp(r,2),g.e(r,dEX(v,F),4);case 4:return x=r.L,g.e(r,Z_x(x),5);case 5:K=FsU(x);g.Ix(r,3);break;case 2:O=g.DX(r),ZE("getAndProcessSmartDownloadsResponse request or processing error",O);case 3:return r.return(K)}})},j7U=function(v,F,K,x){var O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5;
return g.y(function(qQ){switch(qQ.W){case 1:return g.e(qQ,sC(),2);case 2:O=qQ.L;if(!O)return qQ.return([]);r=[];if((p=x)==null?0:p.length){r=x;qQ.K5(3);break}return g.e(qQ,GR(O,"musicPlaylist"),4);case 4:r=qQ.L;case 3:if(!r.length)return qQ.return([]);T=[];I=Date.now()/1E3;D=g.P(r);E=D.next();case 5:if(E.done)return T.length?g.e(qQ,nIM(T),10):qQ.return([]);Y=E.value;N=void 0;n=(w=(N=Y)==null?void 0:N.entityMetadata)&&w.nextAutoRefreshIntervalSeconds?Number(w.nextAutoRefreshIntervalSeconds):NaN;V=
Number.isNaN(n)?v:n;X=h=0;M="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!Y.downloadMetadata){qQ.K5(8);break}return g.e(qQ,Hi(O,Y.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:J=qQ.L,u=f=void 0,h=Number((u=(f=J)==null?void 0:f.addedTimestampMillis)!=null?u:"0")/1E3,g_=t=void 0,X=Number((g_=(t=J)==null?void 0:t.lastModifiedTimestampMillis)!=null?g_:"0")/1E3,xe=F_=void 0,M=(xe=(F_=J)==null?void 0:F_.syncState)!=null?xe:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:QA=void 0;if(K||M!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!w||Number((QA=w.lastSyncedTimestampSeconds)!=null?QA:0)+V<=I){iU=[];KE=void 0;if((KE=Y.tracks)==null?0:KE.length)for(jU=g.P(Y.tracks),B5=jU.next();!B5.done;B5=jU.next())QU=B5.value,iU.push(g.CY(QU).entityId);or={playlistId:Y.playlistId,videoIds:iU,offlineLastModifiedTimestamp:String(X.toFixed()),autoSync:F,offlineDateAddedTimestamp:String(h.toFixed())};T.push(or)}E=D.next();qQ.K5(5);break;case 10:return W5=qQ.L,qQ.return(W5)}})},dEX=function(v,F){var K,x,O,r,p,T,I,D,E,Y;
return g.y(function(N){switch(N.W){case 1:return K=g.Wb(),g.e(N,sC(),2);case 2:x=N.L;if(!x){N.K5(3);break}return g.e(N,Vq1(x),4);case 4:O=N.L;case 3:var w=O;r={context:g.B9(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:v},offlineClientState:w,clientStateRequestData:{preferredFormatType:F}}}};p=g.Fn(mEv);g.pp(N,5);I={fG:!0};return g.e(N,g.bE(K,r,p,void 0,I),7);case 7:T=N.L;g.Ix(N,6);break;case 5:D=g.DX(N);if(D instanceof g.GE)throw E=
"DPS network manager error for smart downloads: "+D.message,ZE(E,D),Error(E);ZE("DPS fetch request error for smart downloads",D);throw Error("DPS fetch request error for smart downloads");case 6:Y=aJ(T);if(T)Y!==void 0&&RJ(Y,"smart downloads");else throw ZE("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return N.return(T)}})},aMM=function(v,F){var K,x,O,r,p,T,I,D;
return g.y(function(E){switch(E.W){case 1:return K=g.Wb(),x={context:g.B9(),videoPlaybackPositionEntities:v,lastSyncTimestampUsec:F},O=g.Fn(hyA),g.pp(E,2),p={fG:!0},g.e(E,g.bE(K,x,O,void 0,p),4);case 4:r=E.L;g.Ix(E,3);break;case 2:T=g.DX(E);if(T instanceof g.GE)throw I="VPPS network manager error: "+T.message,ZE(I,T),Error(I);ZE("VPPS fetch request error",T);throw Error("VPPS fetch request error");case 3:D=aJ(r);if(r)D!==void 0&&RJ(D,"position sync");else throw ZE("Network request failed for position sync"),
Error("Network request failed for position sync");return E.return(r)}})},kOA=function(v,F,K){var x,O,r,p,T,I,D,E;
return g.y(function(Y){switch(Y.W){case 1:x=g.Wb();var N=K.refreshData,w=K.isEnqueuedForExpiredStreamUrlRefetch,n=K.FY,V=K.offlineSourceData,h=K.mediaCapabilities,X={entityKey:v};N&&(X.refreshData=N);w&&(X.isExpiredStreamUrlRefetch=w);n&&(X.downloadParameters=n);V&&(X.offlineSourceData=V);N={context:g.Du(F),signatureTimestamp:20409,videos:[X]};h&&(N.mediaCapabilities=h);O=N;r=g.Fn(RyA);g.pp(Y,2);T={fG:!0};return g.e(Y,g.bE(x,O,r,void 0,T),4);case 4:p=Y.L;g.Ix(Y,3);break;case 2:I=g.DX(Y);if(I instanceof
g.GE)throw D="GetPDE network manager error: "+I.message,ZE(D,I),Error(D);ZE("GetPDE fetch request error",I);throw Error("GetPDE fetch request error");case 3:E=aJ(p);if(p)E!==void 0&&RJ(E,"PDE");else throw ZE("Network request failed for PDE"),Error("Network request failed for PDE");return Y.return(p)}})},aJ=function(v){var F;
return(F=v.errorMetadata)==null?void 0:F.status},RJ=function(v,F){F=F?" for "+F:"";
if(v===0)throw v="Empty response body"+F,ZE(v),Error(v);v="Response with error"+F;ZE(v);throw Error(v);},nIM=function(v){var F,K,x,O,r,p,T,I;
return g.y(function(D){switch(D.W){case 1:return F=g.Wb(),K=wX1(v),x=g.Fn(M9h),g.pp(D,2),r={fG:!0},g.e(D,g.bE(F,K,x,void 0,r),4);case 4:O=D.L;g.Ix(D,3);break;case 2:p=g.DX(D);if(p instanceof g.GE)throw T="offlinePlaylistSyncCheck network manager error: "+p.message,ZE(T,p),Error(T);ZE("offlinePlaylistSyncCheck fetch request error",p);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:I=aJ(O);if(!O)throw ZE("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(I!==void 0)RJ(I,"playlist sync");else if(!O.offlinePlaylistSyncCheckDatas||!O.offlinePlaylistSyncCheckDatas.length)throw ZE("No data for playlist sync"),Error("No data for playlist sync");return D.return(O.offlinePlaylistSyncCheckDatas.map(function(E){return E.offlinePlaylistSyncCheckData}))}})},km=function(v){this.W=v},UEv=function(v,F){var K,x,O,r,p,T;
return g.y(function(I){switch(I.W){case 1:K=new Map,x=g.P(F),O=x.next();case 2:if(O.done){I.K5(4);break}r=O.value;p=K;T=p.set;return g.e(I,v.L(r),5);case 5:T.call(p,r,I.L);O=x.next();I.K5(2);break;case 4:return I.return(K)}})},Mb=function(v,F,K,x,O,r){F=g.zc(F,K);
x=Object.assign({},r,{priority:x,retryScheduleIntervalsInSeconds:O});return{actionType:v,entityKey:F,actionMetadata:x}},Ui=function(v,F,K,x,O,r){this.status=v;
this.W=F;this.G=K;this.L=x;this.D=O;this.downloadState=r},$Ep=function(v,F,K){this.W=v;
this.N=F;this.D=K},JMX=function(v,F){var K,x,O,r,p,T,I,D,E;
return g.y(function(Y){switch(Y.W){case 1:return K=F.entityKey,O=(x=g.S(F.actionMetadata,$m))==null?void 0:x.isEnqueuedForExpiredStreamUrlRefetch,g.pp(Y,2),r=void 0,g.e(Y,XA1(v,F),4);case 4:r=Y.L;g.pp(Y,5);var N=(N=g.S(F.actionMetadata,$m))?{maximumDownloadQuality:N.maximumDownloadQuality}:void 0;return g.e(Y,kOA(K,v.N,{isEnqueuedForExpiredStreamUrlRefetch:O,FY:N,offlineSourceData:r}),7);case 7:p=Y.L;g.Ix(Y,6,2);break;case 5:return g.DX(Y,2),T=Oi(F)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ZE("PDE handleAdd error"),Y.return(Xs(F,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",T,"DOWNLOAD_STATE_FAILED"));case 6:return g.e(Y,PSX(v,p,F),8);case 8:return Y.return(Xs(F,!0,p.orchestrationActions));case 2:return I=g.DX(Y),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.Ng&&I.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ZE("PDE handleAdd error"),Y.return(Xs(F,!1,void 0,D,E,"DOWNLOAD_STATE_FAILED"))}})},q1M=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe;
return g.y(function(QA){switch(QA.W){case 1:return K=F.entityKey,x=g.CY(K).entityId,g.e(QA,CA(v.W,{mode:"readonly",X$:!0},function(iU){var KE=ek(iU,K,"playbackData"),jU=ek(iU,g.zc(x,"offlineVideoPolicy"),"offlineVideoPolicy");iU=ek(iU,g.zc(x,"transfer"),"transfer");return g.mK.all([KE,jU,iU])}),2);
case 2:O=QA.L;r=g.P(O);p=r.next().value;T=r.next().value;I=r.next().value;D=p;E=T;Y=I;if(!D||!E)return QA.return(Xs(F,!0));N=[];V=((n=D)==null?0:n.playerResponseJson)?JSON.parse(D.playerResponseJson):null;if(!(Y&&V&&v.N.S("html5_refresh_deprecated_downloads"))){QA.K5(3);break}w=lMM(v,V,Y);return g.e(QA,fMX(v,Y),4);case 4:N=QA.L;case 3:h={lastPlayerResponseTimestampSeconds:D.playerResponseTimestamp,offlineToken:E.offlineToken,formatIds:N};X={};if((M=Y)==null?0:M.maximumDownloadQuality)X.maximumDownloadQuality=
Y.maximumDownloadQuality;g.pp(QA,5);J=void 0;return g.e(QA,XA1(v,F),7);case 7:return J=QA.L,g.pp(QA,8),g.e(QA,kOA(K,v.N,{refreshData:h,FY:X,offlineSourceData:J,mediaCapabilities:w}),10);case 10:f=QA.L;g.Ix(QA,9,5);break;case 8:return g.DX(QA,5),u=Oi(F)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ZE("PDE handleRefresh error"),QA.return(Xs(F,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",u,"DOWNLOAD_STATE_FAILED"));
case 9:return g.e(QA,PSX(v,f,F),11);case 11:return QA.return(Xs(F,!0,f.orchestrationActions));case 5:return t=g.DX(QA),g_="PDE handleRefresh error",t instanceof Error&&(g_="PDE handleRefresh error: "+t.message),F_="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",xe="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.Ng&&t.type==="QUOTA_EXCEEDED"&&(F_="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",xe="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ZE(g_),QA.return(Xs(F,
!1,void 0,F_,xe,"DOWNLOAD_STATE_FAILED"))}})},XA1=function(v,F){var K,x,O,r;
return g.y(function(p){if(p.W==1)return K=g.CY(F.entityKey).entityId,x=g.zc(K,"videoDownloadContextEntity"),g.e(p,Hi(v.W,x,"videoDownloadContextEntity"),2);O=p.L;return(r=O)!=null&&r.offlineModeType?p.return({offlineModeType:O.offlineModeType}):p.return(void 0)})},PSX=function(v,F,K){var x,O,r,p,T;
return g.y(function(I){if(I.W==1){if(!F.frameworkUpdates||!g.S(F.frameworkUpdates,S1))return I.return();if(!(g.S(F.frameworkUpdates,S1).mutations&&g.S(F.frameworkUpdates,S1).mutations.length>0&&g.S(F.frameworkUpdates,S1).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return I.K5(2);x=g.CY(g.S(F.frameworkUpdates,S1).mutations[0].entityKey).entityId;return g.e(I,dQ(v.W,x),3)}if(I.W!=2){O=I.L;r=g.S(K.actionMetadata,$m);if(T=(p=r)==null?void 0:p.playlistId)O.playlistId=T;O.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.p$(v.N)?g.e(I,LC(x,v.W,K,v.D,O),2):g.ec(v.N)?g.e(I,VW(x,v.W,K,v.D),2):I.K5(2)}return g.e(I,O_d(g.S(F.frameworkUpdates,S1)),0)})},Xs=function(v,F,K,x,O,r){return new Ui(F?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Oi(v),K,x,O,r)},lMM=function(v,F,K){F=AEA(v.N,K.cotn,F);
K=g.dW(F);return g.IIs(F,K,v.N)},fMX=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N;
return g.y(function(w){if(w.W==1)return K=[],g.e(w,CA(v.W,{mode:"readonly",X$:!0},function(n){var V=[],h=F.offlineVideoStreams;if(h){h=g.P(h);for(var X=h.next();!X.done;X=h.next())V.push(ek(n,X.value,"offlineVideoStreams"))}return g.mK.all(V)}),2);
if(x=w.L)for(O=g.P(x),r=O.next();!r.done;r=O.next())if(p=r.value,T=void 0,(T=p)==null?0:T.streamsProgress)for(I=p.streamsProgress,D=0;D<I.length;D++)E=I[D],Y=JSON.parse(E.formatStreamBytes),N={itag:Y.itag,lmt:Y.lastModified,xtags:Y.xtags},K.push(N);return w.return(K)})},eyU=function(v,F){this.W=v;
this.N=F},bGx=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w;
return g.y(function(n){switch(n.W){case 1:return K=Oi(F),g.e(n,GR(v.W,"videoPlaybackPositionEntity"),2);case 2:x=n.L;if(x.length===0)return n.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));g.pp(n,3);return g.e(n,lo.getInstance(),5);case 5:O=n.L;if(!O)throw Error("prefStorage is undefined");return g.e(n,O.get("psi"),6);case 6:return r=n.L,I=(T=(p=r)==null?void 0:p.w2)!=null?T:"0",g.e(n,aMM(x,I),7);case 7:return D=n.L,E={isPaused:D.watchHistoryPaused,w2:D.syncTimestampUsec},g.e(n,O.set("psi",
E),8);case 8:if(E.isPaused){n.K5(9);break}Y=g.S(D.frameworkUpdates,S1);if(!D.frameworkUpdates||!Y){n.K5(9);break}return g.e(n,O_d(Y),9);case 9:g.Ix(n,4);break;case 3:return N=g.DX(n),w="PPE handleRefresh error: "+(N instanceof Error?N.message:"unknown error"),ZE(w),n.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return n.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K))}})},oIz=function(v,F){var K,x,O,r,p,T,I,D;
return g.y(function(E){switch(E.W){case 1:return K=Oi(F),x=g.CY(F.entityKey).entityId,g.pp(E,2),g.e(E,lo.getInstance(),4);case 4:O=E.L;if(!O)throw Error("prefStorage is undefined");return g.e(E,O.get("psi"),5);case 5:r=E.L;p=g.S(F.actionMetadata,yMN);if(((T=r)==null?void 0:T.isPaused)!==!1||(I=p)==null||!I.lastPlaybackPositionSeconds){E.K5(6);break}D={key:g.zc(x,"videoPlaybackPositionEntity"),videoId:x,lastPlaybackPositionSeconds:p.lastPlaybackPositionSeconds};return g.e(E,zR(v.W,D,"videoPlaybackPositionEntity"),
6);case 6:g.Ix(E,3);break;case 2:return g.DX(E),E.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K))}})},t9U=function(v,F){var K,x,O;
return g.y(function(r){switch(r.W){case 1:K=Oi(F);g.pp(r,2);x=g.CY(F.entityKey).entityId;if(x==="!*$_ALL_ENTITIES_!*$")return g.e(r,v4z(v.W),5);O=g.zc(x,"videoPlaybackPositionEntity");return g.e(r,ZxU(v.W,O),5);case 5:g.Ix(r,3);break;case 2:return g.DX(r),r.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K))}})},uCN=function(v,F){this.api=v;
this.W=F;this.logger=new g.VR("woffle");this.L=!1;this.VR={P3:this.P3}},AMz=function(v){return g.y(function(F){return F.return(E4h(v))})},CSU=function(v){var F;
return g.y(function(K){if(K.W==1)return g.e(K,g.dZc(v),2);F=K.L;return K.return(F.filter(function(x){return!!x.url}).map(function(x){return x.url}))})},PG=function(v,F){var K=g.A2(F);
if(K===1||K===0)return Promise.resolve();(K=zyX(v,F))&&K.stopVideo();v.D=0;return AMz(F)},Ju=function(v,F,K,x){K=K===void 0?!1:K;
x=x===void 0?!0:x;F=typeof F==="string"?F:F.videoDetails.videoId;if(g.A2(F)===2){var O=zyX(v,F);O&&O.stopVideo();g.C$(F,2);v.D=2;K?HGp(v.W):x&&GOh(v.W)}},zyX=function(v,F){var K;
return((K=v.player)==null?void 0:K.getVideoData().videoId)===F?v.player:null},s7d=function(v,F){this.W=v;
this.N=F},WsN=function(v,F){var K,x;
return g.y(function(O){switch(O.W){case 1:return K=Oi(F),g.e(O,Hi(v.W,F.entityKey,"transfer"),2);case 2:if(x=O.L)return O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));g.pp(O,3);return g.e(O,cMX(v,F),5);case 5:g.Ix(O,4);break;case 3:return g.DX(O),O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K))}})},Bvp=function(v,F){var K,x;
return g.y(function(O){switch(O.W){case 1:return K=Oi(F),g.e(O,Hi(v.W,F.entityKey,"transfer"),2);case 2:x=O.L;if(!x||x.transferState!=="TRANSFER_STATE_COMPLETE")return O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));g.pp(O,3);return g.e(O,cMX(v,F,!0),5);case 5:g.Ix(O,4);break;case 3:return g.DX(O),O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K))}})},ZGn=function(v,F){var K,x,O,r,p,T,I,D,E,Y;
return g.y(function(N){switch(N.W){case 1:return K=Oi(F),x=g.CY(F.entityKey).entityId,g.e(N,CA(v.W,{mode:"readonly",X$:!0},function(w){var n=ek(w,F.entityKey,"transfer");w=ek(w,g.zc(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.mK.all([n,w])}),2);
case 2:O=N.L;r=g.P(O);p=r.next().value;T=r.next().value;I=p;D=T;if(!I||I.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return N.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));g.pp(N,3);I.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.e(N,zR(v.W,I,"transfer"),5);case 5:E=g.CY(I.key).entityId;elU({videoId:E,Eq:I,offlineModeType:(Y=D)==null?void 0:Y.offlineModeType});g.Ix(N,4);break;case 3:return g.DX(N),N.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K))}})},cMX=function(v,F,K){K=K===void 0?!1:K;
var x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X;return g.y(function(M){switch(M.W){case 1:return x=g.S(F.actionMetadata,vdh),O=g.CY(F.entityKey).entityId,r=g.zc(O,"downloadStatusEntity"),g.e(M,CA(v.W,{mode:"readonly",X$:!0},function(J){var f=ek(J,r,"downloadStatusEntity");J=ek(J,g.zc(O,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.mK.all([f,J])}),2);
case 2:return p=M.L,T=g.P(p),I=T.next().value,D=T.next().value,E=I,Y=D,N="TRANSFER_STATE_TRANSFER_IN_QUEUE",((w=E)==null?void 0:w.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(N="TRANSFER_STATE_PAUSED_BY_USER"),h={key:F.entityKey,transferState:N,cotn:g.nX(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(n=x)==null?void 0:n.maximumDownloadQuality,preferredAudioTrack:(V=x)==null?void 0:V.preferredAudioTrack,transferRetryCount:0,isRefresh:K,hasLoggedFirstStarted:!1},g.e(M,CA(v.W,
{mode:"readwrite",X$:!0},function(J){var f=[];K&&f.push(tk(J,g.zc(O,"offlineVideoStreams")));f.push(o3(J,h,"transfer"));return g.mK.all(f)}),3);
case 3:if(!K){M.K5(4);break}return g.e(M,AMz(O),4);case 4:f3v({videoId:O,Eq:h,offlineModeType:(X=Y)==null?void 0:X.offlineModeType}),g.rd(M)}})},K7A=function(v,F,K,x){if(!v.action.entityKey)throw Error("entityKey is missing.");
var O=g.CY(v.action.entityKey);O={entityType:O.Ry,entityId:O.entityId,offlineOrchestrationActionType:v.action.actionType,orchestrationAction:{orchestrationActionId:v.actionId}};F&&(O.offlineOrchestrationActionResult=F.status,O.isRetryable=K?!1:F.W,F.D&&(O.offlineOrchestrationFailureReason=F7A(F.D,O.isRetryable)));var r,p;if((r=v.action.actionMetadata)==null?0:(p=r.offlineLoggingData)==null?0:p.offlineModeType)O.offlineModeType=v.action.actionMetadata.offlineLoggingData.offlineModeType;x&&(O.additionalOrchestrationActions=
x.map(function(T){return{orchestrationActionId:T.actionId}}));
return O},F7A=function(v,F){return v!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||F?v==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&F?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":v:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},xGU=function(v,F){var K={offlineOrchestrationContext:K7A(v)};
F=SFX(F,K);dxA(L9z(),F,v.rootActionId)},gdp=function(v,F,K,x){x=x===void 0?[]:x;
F={offlineOrchestrationContext:K7A(v,F,K,x)};F=SFX(3,F);dxA(L9z(),F,v.rootActionId)},O81=function(){this.actions=[]},rXx=function(v,F){F=g.P(F);
for(var K=F.next();!K.done;K=F.next())K=K.value,xGU(K,1),v.actions.push(K);v.actions.sort(v.W)},pPU=function(v,F){if(F)for(var K=0;K<v.actions.length;K++)if(F==="!*$_ALL_ENTITIES_!*$"&&v.actions[K].actionId!==F||F!=="!*$_ALL_ENTITIES_!*$"&&v.actions[K].rootActionId===F&&v.actions[K].actionId!==F)v.actions.splice(K,1),K--},Qo1=function(v,F){v=g.P(v.actions);
for(var K=v.next();!K.done;K=v.next())if(K.value.actionId===F)return!0;return!1},lV=function(v,F,K,x,O){g.A.call(this);
var r=this;this.L=v;this.f5=F;this.qb=K;this.X=x;this.N=O;this.W=new O81;this.j=new g.zB;this.D=new g.vu(function(){r.retry()});
this.T=NaN;this.C=!1;this.VR={wZP:function(){return r.W},
Go:function(){return r.j},
E_C:function(){return r.D},
retry:function(){return r.retry()}};
g.C(this,this.D);this.tP=this.L.observe(this.L5.bind(this))},DGN=function(v,F,K,x,O){var r;
return g.y(function(p){if(p.W==1)return r=new lV(v,F,K,x,O),g.e(p,Trv(r),2);IYA(r);return p.return(r)})},IYA=function(v){var F=v.W.actions[0];
return v.G?((F==null?void 0:F.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&v.G[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(v.C=!0),Promise.resolve()):EdA(v)},EdA=function(v){var F,K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X;
return g.y(function(M){switch(M.W){case 1:if(v.G)throw Error("Already processing an action");if(v.jC())return M.return();F=v.W.actions.shift();JEh(v.qb,!F);if(F===void 0)return M.return();F.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&F.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&pPU(v.W,F.actionId);K="";F.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&F.rootActionId===F.actionId&&(K=F.actionId);x=[F];v.G=x;if(O=v.f5[F.entityType]){M.K5(2);break}v.G=
void 0;return g.e(M,EdA(v),3);case 3:return M.return();case 2:r=g.P(x);for(p=r.next();!p.done;p=r.next())T=p.value,xGU(T,2);g.pp(M,4,5);return g.e(M,UEv(O,x.map(function(J){return J.action})),7);
case 7:I=M.L,D=g.P(x),E=D.next();case 8:if(E.done){M.K5(10);break}Y=E.value;N=I.get(Y.action);return g.e(M,i8M(v,Y,N),9);case 9:E=D.next();M.K5(8);break;case 10:pPU(v.W,K);case 5:g.Ev(M);v.G=void 0;g.iz(M,6);break;case 4:return w=g.DX(M),ZE("Orchestration error",w),g.pp(M,12),g.e(M,YYd(v,x),14);case 14:g.Ix(M,5);break;case 12:n=g.DX(M);ZE("Orchestration retry error",n);V=g.P(x);for(h=V.next();!h.done;h=V.next())X=h.value,X.retryScheduleIndex<3&&rXx(v.W,[X]);M.K5(5);break;case 6:return g.e(M,EdA(v),
0)}})},i8M=function(v,F,K){var x,O,r,p,T,I,D,E,Y,N,w,n;
return g.y(function(V){switch(V.W){case 1:x=F.retryScheduleIndex+2===3;if(K.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){V.K5(2);break}if(K.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){V.K5(0);break}gdp(F,K,x);if(K.W&&F.retryScheduleIndex+1<3)return g.e(V,YYd(v,[F]),0);r=((O=K)==null?0:O.L)?K.L:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";p={entityKey:F.action.entityKey,failureReason:r};T=void 0;g.p$(v.N)?T="mainVideoDownloadStateEntity":g.ec(v.N)&&(T="musicTrackDownloadMetadataEntity");
if(!T||!K.downloadState){V.K5(7);break}I=g.CY(F.action.entityKey).entityId;return g.e(V,Tb(I,T,v.L,K.downloadState),7);case 7:Fs(v.X,p);if(K.downloadState==="DOWNLOAD_STATE_FAILED"&&v.N.S("html5_auto_retry_failed_pde_actions")){V.K5(0);break}ZE("Orchestration result is not retryable, deleting action");return g.e(V,ZxU(v.L,wQ(F).key),0);case 2:D=void 0;try{D=(E=K.G)==null?void 0:E.map(function(h){return v.createAction(h,F)})}catch(h){return gdp(F,K,x),Y={entityKey:F.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Fs(v.X,Y),ZE("Orchestration subactions creation error",h),V.return()}gdp(F,K,x,D);if(!D){V.K5(12);break}N=D.map(function(h){return wQ(h)});
w=0;case 13:if(!(w<D.length)||v.C){V.K5(15);break}return g.e(V,CA(v.L,{mode:"readwrite",X$:!0},function(h){var X=[];X.push(uJd(h,N.slice(w,w+10),"offlineOrchestrationActionWrapperEntity"));return g.mK.all(X)}),16);
case 16:w+=10;V.K5(13);break;case 15:if(v.C)return v.C=!1,V.return();case 12:return n=wQ(F),g.e(V,ZxU(v.L,n.key),17);case 17:xGU(F,4),g.rd(V)}})},L7A=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w;
return g.y(function(n){K=[];x=Infinity;O=4E3;r=g.P(F);for(p=r.next();!p.done;p=r.next())T=p.value,I=Number(T.enqueueTimeSec),D=wPX(I),E=T.retryScheduleIndex,Y=E!=null&&E>0,D>0&&Y?(x=Math.min(x,I),O=Math.min(D,O)):K.push(T);isFinite(x)&&(!v.D.isActive()||x<v.T)&&(v.T=x,v.D.start(O));v.j.C7()||(N=K.length,K=K.filter(function(V){var h;V=((h=V.actionProto)==null?void 0:h.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!NrU.includes(V)}),w=K.length<N,!v.D.isActive()&&w&&v.D.start(1));
K.length>0&&nd1(v,K);return g.e(n,IYA(v),0)})},dGp=function(v){var F,K,x,O,r,p,T;
return g.y(function(I){if(I.W==1)return g.e(I,SYv(v),2);F=I.L;K=[];x=g.P(F);for(O=x.next();!O.done;O=x.next())r=O.value,p=g.CY(r.key),T=p.entityId,Qo1(v.W,T)||K.push(r);return g.e(I,L7A(v,K),0)})},wPX=function(v){v=v*1E3-Date.now();
return v>4E3?4E3:v},YYd=function(v,F){var K,x,O;
return g.y(function(r){K=g.P(F);for(x=K.next();!x.done;x=K.next()){O=x.value;var p=void 0,T=void 0,I=((T=O.action)==null?void 0:(p=T.actionMetadata)==null?void 0:p.retryScheduleIntervalsInSeconds)||[1,2,4];p=1;O.retryScheduleIndex<I.length&&(p=I[O.retryScheduleIndex]);O.W=p*1E3+Date.now();O.retryScheduleIndex++}return g.e(r,Vmp(v,F),0)})},Trv=function(v){var F;
return g.y(function(K){if(K.W==1)return g.e(K,GR(v.L,"offlineOrchestrationActionWrapperEntity"),2);F=K.L;return g.e(K,L7A(v,F),0)})},nd1=function(v,F){F.length!==0&&F.forEach(function(K){K=Ym(K);
K.retryScheduleIndex<3&&rXx(v.W,[K])})},SYv=function(v,F){var K;
return g.y(function(x){if(x.W==1)return g.e(x,GR(v.L,"offlineOrchestrationActionWrapperEntity",F),2);K=x.L;return x.return(K.filter(rEN))})},Vmp=function(v,F){if(F.length===0)return Promise.resolve([]);
F=F.map(function(K){return wQ(K)});
return Bwx(v.L,F)},joA=function(v){this.Ef=v;
this.W=void 0},mGn=function(v,F){var K,x,O,r;
return g.y(function(p){K=F.videoId;x=!0;if(F.captionTracks.length)O=PIx(F),v.W=new g.Y3(v.Ef,F,O);else if(F.PT)r=g.JRc(F),v.W=new g.NH(v.Ef,F.PT,K,r,F.kP,F.eventId),x=F.kP;else return p.return();return p.return(new Promise(function(T){var I;(I=v.W)==null||I.oQ({x6:function(){return g.y(function(D){if(D.W==1)return g.e(D,v.x6(K,x),2);T();g.rd(D)})},
wC:function(){}})}))})},hgN=function(v){var F;
return g.y(function(K){if(K.W==1)return g.e(K,DxN(v),2);F=K.L;return K.return(!!F&&F.length>0)})},fC=function(v){g.A.call(this);
this.W=v;this.L=this.W.observe(this.D.bind(this))},aYz=function(v,F){var K,x,O,r,p,T,I;
return g.y(function(D){switch(D.W){case 1:if(F.length===0)return D.return([]);K=F.map(function(E){return g.zc(E,"transfer")});
return g.e(D,GR(v.W,"transfer",K),2);case 2:x=D.L;O=x.filter(rEN).map(function(E){return g.CY(E.key).entityId});
r=F.filter(function(E){return O.indexOf(E)===-1});
if(r.length===0)return D.return([]);p=g.P(r);T=p.next();case 3:if(T.done){D.K5(5);break}I=T.value;return g.e(D,AMz(I),4);case 4:T=p.next();D.K5(3);break;case 5:return D.return(r)}})},Mmx=function(v,F,K,x,O,r){var p,T,I;
return g.y(function(D){p="STREAM_TYPE_UNKNOWN";K.video&&K.audio?(p="STREAM_TYPE_AUDIO_AND_VIDEO",ZE("unexpected stream type")):K.video&&!K.audio?p="STREAM_TYPE_VIDEO":!K.video&&K.audio&&(p="STREAM_TYPE_AUDIO");T=g.zc(F,"offlineVideoStreams");I={numBytesDownloaded:O.toFixed(),numTotalBytes:r.toFixed(),streamType:p,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(x),itag:p==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(K.itag):void 0};return g.e(D,CA(v,{mode:"readwrite",X$:!0},
function(E){var Y=ek(E,T,"offlineVideoStreams"),N=ek(E,g.zc(F,"transfer"),"transfer");return g.mK.all([Y,N]).then(function(w){w=g.P(w);var n=w.next().value;w=w.next().value;if(!w)return tk(E,T).then(function(){});
var V=RgM(n);n=kM1(n,x,I,T);var h=o3(E,n,"offlineVideoStreams");RgM(n)>V&&(w.lastProgressTimeMs=Date.now().toString());V=[h];w.offlineVideoStreams||(w.offlineVideoStreams=[]);w.offlineVideoStreams.indexOf(T)===-1&&(w.offlineVideoStreams.push(T),V.push(o3(E,w,"transfer")));return g.mK.all(V)})}),0)})},UGx=function(v,F){var K,x,O,r,p;
return g.y(function(T){if(T.W==1)return K=g.zc(F,"offlineVideoStreams"),g.e(T,Hi(v,K,"offlineVideoStreams"),2);x=T.L;if(!x||!x.streamsProgress)return T.return();O=g.P(x.streamsProgress);for(r=O.next();!r.done;r=O.next())p=r.value,p.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",p.numTotalBytes!==p.numBytesDownloaded&&(p.numBytesDownloaded=p.numTotalBytes);return g.e(T,zR(v,x,"offlineVideoStreams"),0)})},kM1=function(v,F,K,x){if(v&&v.streamsProgress){x=v;
a:{F=F.itag+";"+F.xtags;for(var O=v.streamsProgress,r=0;r<O.length;r++){var p=JSON.parse(O[r].formatStreamBytes);if(p.itag+";"+p.xtags===F){O[r]=K;K=O;break a}}O.push(K);K=O}x.streamsProgress=K}else v={key:x,streamsProgress:[K]};return v},RgM=function(v){if(v==null?0:v.streamsProgress){var F=0;
v=v.streamsProgress;for(var K=0;K<v.length;K++){var x=v[K];isNaN(Number(x.numBytesDownloaded))?ZE("stream progress bytes number invalid"):F+=Number(x.numBytesDownloaded)}return F}return 0},$GX=function(v,F,K,x){g.A.call(this);
var O=this;this.L=v;this.api=F;this.Xx=K;this.L5=x;this.j=new g.zB;this.G=new g.vu(function(){O.W&&O.W.transferState==="TRANSFER_STATE_TRANSFERRING"&&O.j.C7()&&((O.W.transferRetryCount||0)<3?Ju(O.X,O.C,!1,!1):PG(O.X,O.C.videoDetails.videoId),O.GM("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.qb=this.xZ=0;this.tP=this.T=!1;this.oP=g.Bj(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.rE=new g.Em(this);this.VR={m85:function(){return O.G},
Gnf:function(){return O.L5},
Go:function(){return O.j}};
this.f5=this.L.observe(this.Ws.bind(this));this.X=new uCN(F,this);this.gE=new joA(F);this.C5=new fC(this.L);this.SC=this.j.listen("publicytnetworkstatus-online",this.Ei.bind(this));this.Zg=this.j.listen("publicytnetworkstatus-offline",this.LEE.bind(this));this.tP=this.api.U().S("html5_less_transfer_processing_logs");g.C(this,this.rE);this.rE.B(F,"offlinetransferpause",this.QvP);if(g.p$(this.api.U()))this.D="mainVideoDownloadStateEntity";else if(g.ec(this.api.U())||g.TT(this.api.U()))this.D="musicTrackDownloadMetadataEntity"},
XPA=function(v){return g.y(function(F){if(F.W==1)F=g.e(F,T5U(),2);
else{var K=v.C5;var x=g.uK();x=Object.keys(x);K=aYz(K,x);F=g.e(F,K,0)}return F})},e1=function(v,F){F=F===void 0?!1:F;
var K;return g.y(function(x){if(x.W==1){if(v.W)throw Error("Already downloading a video");v.qb=0;v.T=!1;return g.e(x,PPX(v),2)}return x.W!=4?(K=x.L,l3X(v.Xx,!K),K&&v.j.C7()?F?g.e(x,new Promise(function(O){g.jj(O,1E3)}),4):x.K5(4):(!K&&v.W&&qb(v),x.K5(0))):g.e(x,JXN(v,K),0)})},lYU=function(v){return g.y(function(F){if(F.W==1)return v.C?g.e(F,PG(v.X,v.C.videoDetails.videoId),3):F.K5(0);
qb(v);g.rd(F)})},fYU=function(v,F){var K,x,O;
return g.y(function(r){switch(r.W){case 1:return g.pp(r,2),(K=!!F.captionTracks.length||!!F.PT)?g.e(r,hgN(F.videoId),4):r.return();case 4:return(x=r.L)?r.return():g.e(r,mGn(v.gE,F),5);case 5:g.Ix(r,0);break;case 2:O=g.DX(r),ZE("Caption downloading error",O,F.cotn),g.rd(r)}})},JXN=function(v,F){var K,x,O,r,p,T;
return g.y(function(I){switch(I.W){case 1:if(v.T)return I.return();v.T=!0;v.W=F;K=g.CY(v.W.key);x=K.entityId;O=void 0;if(v.W.transferState==="TRANSFER_STATE_TRANSFERRING")return g.e(I,bV(v,x),7);if(v.W.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||v.W.transferRetryCount||v.W.hasLoggedFirstStarted){I.K5(3);break}return g.e(I,bV(v,x),5);case 5:return O=I.L,v.W.hasLoggedFirstStarted=!0,g.e(I,qYN(v),6);case 6:qFA({videoId:x,Eq:v.W,offlineModeType:O},void 0,void 0,!0);I.K5(3);break;case 7:O=I.L,
gQ({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:x,Eq:v.W,offlineModeType:O});case 3:return g.e(I,egX(v),8);case 8:return r=null,g.pp(I,9),g.e(I,b8h(v,F),11);case 11:r=I.L;v.C=r;g.Ix(I,10);break;case 9:return p=g.DX(I),ZE("error getting player response",p,F.cotn),g.e(I,v.GM("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return I.return();case 10:return T=AEA(v.api.U(),F.cotn,r),g.e(I,fYU(v,T),13);case 13:return g.e(I,CSU(T.videoId),
14);case 14:T.H8=I.L;var D=v.X,E=T,Y=F.maximumDownloadQuality;E.getPlayerResponse();g.C$(E.videoId,2);D.D=2;D.L=!1;var N;(N=D.player)==null||N.dispose();D.player=D.api.FO(E);E={};D.player.Zu((E.localmediachange=D.I1,E.signatureexpired=D.Z3,E.statechange=D.Seg,E),D);D.S("html5_generate_content_po_token")&&D.player.qI();Y=D.P3(Y);D.player.HE(g.fZ(Y,Y,!0,"m"),!1);D.player.Kf(!1);v.G.start(108E5);g.rd(I)}})},PPX=function(v){var F,K;
return g.y(function(x){if(x.W==1)return g.e(x,GR(v.L,"transfer"),2);F=x.L;K=F.filter(yX1).sort(odn);return K.length===0?x.return():x.return(K[0])})},egX=function(v){var F,K,x;
return g.y(function(O){if(O.W==1){if(!v.W)return yW(v,"onTransferStart"),O.return();v.G.start(108E5);return g.e(O,oJ(v,"TRANSFER_STATE_TRANSFERRING"),2)}F=v.W;return(x=((K=F)==null?0:K.key)?g.CY(F.key).entityId:"")&&v.D?g.e(O,Tb(x,v.D,v.L,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):O.K5(0)})},HGp=function(v){var F,K,x,O;
g.y(function(r){switch(r.W){case 1:if(!v.W){yW(v,"onTransferPausedByUser");r.K5(2);break}F=v.W;v.G.stop();return g.e(r,oJ(v,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:x=((K=F)==null?0:K.key)?g.CY(F.key).entityId:"";if(!x||!v.D){r.K5(4);break}return g.e(r,Tb(x,v.D,v.L,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.e(r,bV(v,x),6);case 6:O=r.L,b_x({videoId:x,Eq:F,offlineModeType:O});case 2:qb(v),e1(v),g.rd(r)}})},GOh=function(v){var F,K,x;
g.y(function(O){if(O.W==1){if(!v.W)return yW(v,"onTransferPausedByNetwork"),O.return();v.G.stop();return g.e(O,oJ(v,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(O.W!=3)return F=v.W,(x=((K=F)==null?0:K.key)?g.CY(F.key).entityId:"")&&v.D?g.e(O,Tb(x,v.D,v.L,"DOWNLOAD_STATE_PAUSED"),3):O.K5(3);qb(v);g.rd(O)})},tm1=function(v){var F,K,x,O,r;
g.y(function(p){switch(p.W){case 1:if(!v.W)return yW(v,"onTransferComplete"),p.return();F=v.W;v.G.stop();if(!F||!v.C){p.K5(2);break}K=AEA(v.api.U(),F.cotn,v.C);return g.e(p,fYU(v,K),2);case 2:return g.e(p,oJ(v,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:O=((x=F)==null?0:x.key)?g.CY(F.key).entityId:"";if(!O||!v.D){p.K5(5);break}return g.e(p,Tb(O,v.D,v.L,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.e(p,UGx(v.L,O),7);case 7:return g.e(p,bV(v,O),8);case 8:r=p.L,gQ({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:O,Eq:F,offlineModeType:r}),qb(v),e1(v),g.rd(p)}})},ump=function(v,F,K){var x,O;
g.y(function(r){switch(r.W){case 1:if(!v.W)return yW(v,"onTransferProgress: "+F),r.return();if(v.W.transferState==="TRANSFER_STATE_TRANSFERRING"){r.K5(2);break}return g.e(r,egX(v),2);case 2:x=Date.now();if(!(x-v.xZ>1E3)){r.K5(4);break}v.xZ=x;return g.e(r,Mmx(v.L,K.videoId,K.L,K.IK,K.bytesDownloaded,K.W),5);case 5:if(v.tP&&!(v.tP&&x-v.qb>v.oP)){r.K5(4);break}v.qb=x;return g.e(r,bV(v,F),7);case 7:O=r.L,qFA({videoId:F,Eq:v.W,offlineModeType:O},K.bytesDownloaded,K.W);case 4:v.G.start(108E5),g.rd(r)}})},
AXz=function(v){var F=(v.W.transferRetryCount||0)<3;
F&&(v=v.W,v.transferRetryCount=(v.transferRetryCount||0)+1);return F},CPv=function(v,F){F=F===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":F;
var K,x,O,r;return g.y(function(p){if(p.W==1)return v.W||yW(v,"setTransferToFailed: "+F),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F==="TRANSFER_FAILURE_REASON_NETWORK"?K="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":F==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.e(p,oJ(v,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",F),2);if(p.W!=3)return Fs(v.L5,{entityKey:(x=v.W)==null?void 0:x.key,failureReason:K}),
O=v.W?g.CY(v.W.key).entityId:"",g.e(p,bV(v,O),3);r=p.L;var T={videoId:O,Eq:v.W,offlineModeType:r},I=F,D={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};I&&(D.transferFailureReason=I,D.failureReason=yEX(I));gQ(D,T);g.rd(p)})},oJ=function(v,F,K,x){var O;
return g.y(function(r){if(r.W==1){if(!v.W)return yW(v,"saveTransferState: "+F),r.return();v.W.transferState=F;v.W.failureReason=x;g.pp(r,2);return g.e(r,qYN(v,function(p){return K?bo(p,"offlineVideoStreams",v.W.offlineVideoStreams).then(function(T){for(var I=g.P(T),D=I.next();!D.done;D=I.next())if((D=D.value)&&D.streamsProgress){D=g.P(D.streamsProgress);for(var E=D.next();!E.done;E=D.next())E.value.streamState=K}return uJd(p,T.filter(function(Y){return!!Y}),"offlineVideoStreams")}):g.mK.resolve(void 0)}),
4)}if(r.W!=2)return g.Ix(r,0);
O=g.DX(r);return O instanceof g.Ng&&O.type==="QUOTA_EXCEEDED"?g.e(r,v.GM("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):r.K5(0)})},qYN=function(v,F){var K;
return g.y(function(x){if(!v.W)return x.return();K=v.W;return g.e(x,CA(v.L,{mode:"readwrite",X$:!0},function(O){var r=[o3(O,K,"transfer")];F&&r.push(F(O));return g.mK.all(r)}),0)})},qb=function(v){v.W=void 0;
v.C=void 0;v.G.stop()},b8h=function(v,F){var K,x,O,r,p;
return g.y(function(T){if(T.W==1)return K=g.CY(F.key),x=K.entityId,O=g.zc(x,"playbackData"),g.e(T,Hi(v.L,O,"playbackData"),2);r=T.L;if((p=r)==null?0:p.playerResponseJson)return T.return(JSON.parse(r.playerResponseJson));throw Error("No PlayerResponse found");})},yW=function(v,F){v.api.us("woffle",{mcte:F});
ZE("missing current transfer entity.")},bV=function(v,F){var K,x,O;
return g.y(function(r){if(r.W==1)return g.e(r,Hi(v.L,g.zc(F,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);K=r.L;return r.return((O=(x=K)==null?void 0:x.offlineModeType)!=null?O:void 0)})},yX1=function(v){return zgX[v.transferState]!==void 0},odn=function(v,F){var K=zgX[v.transferState],x=zgX[F.transferState];
return K!==x?K-x:Number(v.enqueuedTimestampMs)-Number(F.enqueuedTimestampMs)},tu=function(v,F){var K=this;
this.N=v;this.api=F;this.j=new g.zB;this.C=new g.iR;this.VR={fY:function(){return K.D.VR.fY()},
Go:function(){return K.j},
emi:function(){return K.D},
bG:function(){return K.bG()},
sZ:function(){return K.sZ()},
UZ:function(){return K.UZ()},
Wh:function(){return K.Wh()},
N6:function(){return K.N6()},
HW:function(x){return K.HW(x)}};
this.D=new $xU(function(){return H8d(K)},function(){K.UZ()},this.api.Qu(),this.api.S.bind(this.api));
this.W=new vG(this.api);XXU(this.D)},H8d=function(v){return g.y(function(F){v.api.Vq("onOrchestrationBecameLeader");
return g.e(F,v.sZ(),0)})},soh=function(v){var F,K;
return g.y(function(x){if(x.W==1)return g.e(x,sC(),2);if(x.W!=3){F=x.L;if(!F)return ZE("PES is undefined"),x.return();v.L=new $GX(F,v.api,v.D,v.W);K=v.aX(F);return g.e(x,DGN(F,K,v.D,v.W,v.N),3)}v.X=x.L;return g.e(x,GMp(v),0)})},GMp=function(v){var F;
return g.y(function(K){switch(K.W){case 1:if(!v.L)return ZE("transferManager is undefined"),K.return();if(v.L.W){K.K5(2);break}return g.e(K,e1(v.L),2);case 2:if(!v.N.S("woffle_enable_main_downloads_library")){K.K5(4);break}return g.e(K,v.ek(),4);case 4:if(!v.N.S("html5_offline_playback_position_sync")){K.K5(6);break}return g.e(K,v.rF(),7);case 7:return g.e(K,v.HW(864E5),6);case 6:return g.e(K,v.refreshAllStaleEntities(43200,!0),9);case 9:return g.e(K,v.KE(),10);case 10:if(!v.N.S("html5_retry_downloads_for_expiration")){K.K5(11);
break}return g.e(K,v.N6(),11);case 11:return v.T=g.m_(function(){v.refreshAllStaleEntities(43200,!0);v.KE()},9E5),g.Fq(g.xB(),function(){return v.Wh()}),g.e(K,sC(),13);
case 13:return F=K.L,g.e(K,UxU(F),14);case 14:PmM(v.D),g.rd(K)}})},cXx=function(){var v,F,K,x,O,r;
return g.y(function(p){switch(p.W){case 1:return g.e(p,sC(),2);case 2:v=p.L;if(!v)return p.return([]);F=Date.now()/1E3;return g.e(p,GR(v,"offlineVideoPolicy"),3);case 3:K=p.L,x=g.P(K),O=x.next();case 4:if(O.done){p.K5(6);break}r=O.value;if(!(r.expirationTimestamp&&Number(r.expirationTimestamp)<F)){p.K5(5);break}r.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";r.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.e(p,zR(v,r,"offlineVideoPolicy"),5);
case 5:O=x.next();p.K5(4);break;case 6:return p.return(K.map(function(T){return T.key}))}})},uV=function(v,F,K,x,O){var r,p,T;
return g.y(function(I){if(I.W==1)return g.e(I,sC(),2);r=I.L;if(!r)return I.return([]);p=F.map(function(D){var E=g.zc(D,K);E={actionType:x,entityKey:E,actionMetadata:Object.assign({},CmA(),O)};x!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(E.actionMetadata.priority=0);D=new iV(K,D,E);return wQ(D)});
T=Bwx(r,p);XXU(v.D);return I.return(T)})},W7M=function(v,F,K,x){var O,r,p,T,I,D,E,Y;
return g.y(function(N){switch(N.W){case 1:O=[],r=g.P(F),p=r.next();case 2:if(p.done){N.K5(4);break}T=p.value;if(T.upToDate||K&&!T.shouldAutoSyncMetadata||!T.playlistId){N.K5(3);break}I={};switch(x){case "mainPlaylistEntity":D={nextAutoRefreshIntervalSeconds:T.checkInSeconds,autoSync:K};I={mainPlaylistEntityActionMetadata:D};break;case "musicPlaylist":E={autoSync:K},I={musicPlaylistEntityActionMetadata:E}}return g.e(N,uV(v,[T.playlistId],x,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",I),6);case 6:(Y=
N.L)&&O.push.apply(O,g.l(Y));case 3:p=r.next();N.K5(2);break;case 4:return N.return(O)}})},BrU=function(v,F){var K;
return g.y(function(x){return F.length?(K=CmA(),g.qL(K,$m,{isEnqueuedForExpiredStreamUrlRefetch:!0}),v.api.us("qrd",{v:F.length}),x.return(uV(v,F,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K))):x.return([])})},Z8X=function(v,F,K){this.W=v;
this.N=F;this.D=K},KMv=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M;
return g.y(function(J){switch(J.W){case 1:return K=Oi(F),x=g.CY(F.entityKey),O=x.entityId,r=[],g.pp(J,2),g.e(J,vy1(v,O),4);case 4:r=J.L;if(!(v.N.S("woffle_enable_main_downloads_library")&&((p=r)==null?0:p.length))){J.K5(5);break}return g.e(J,gIX(v.W,[F.entityKey]),5);case 5:g.Ix(J,3);break;case 2:return T=g.DX(J),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Ng&&T.type==="QUOTA_EXCEEDED"?(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):ZE("Playlist add error"),J.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,I,D));case 3:E=[];if(!v.N.S("html5_offline_prevent_redownload_downloaded_video")){J.K5(7);break}return g.e(J,uex(v.W,"mainVideoEntity",r),8);case 8:r=J.L;case 7:if((Y=r)==null?0:Y.length)for(N=g.P(r),w=N.next();!w.done;w=N.next())if(n=w.value,V=n.offlineVideoData,h=void 0,(h=V)==null?0:h.videoId)X=void 0,M=Number(((X=F.actionMetadata)==null?void 0:X.priority)||
0)+1,E.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"mainVideoEntity",M,Au,FMv(F,V,O)));return J.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,E))}})},gyX=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn,Pn,U,FQ,Gh,Ts,$X,a,v5,mv,IZ,cl,DF,Zc,xX,MM,k,m,R,q,G,pE,W,z,b,X_,P5,SU,Uw,Ov,ke,AH,qM,Bn,$e,A0,JG,mN,tG,kT,ax;
return g.y(function(KB){switch(KB.W){case 1:return K=Oi(F),x=F.entityKey,O=g.CY(x).entityId,r=[],p=!1,O==="!*$_ALL_ENTITIES_!*$"?(p=!0,g.e(KB,GR(v.W,"mainPlaylistEntity"),5)):g.e(KB,Hi(v.W,x,"mainPlaylistEntity"),4);case 4:(T=KB.L)&&r.push(T);KB.K5(3);break;case 5:r=KB.L;case 3:if((I=r)==null||!I.length)return KB.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));D=g.S(F.actionMetadata,xPX);Y=(E=D)==null?void 0:E.nextAutoRefreshIntervalSeconds;w=(N=D)==null?void 0:N.autoSync;n=[];h=V=
!0;X=!1;if(!p&&w===!1){KB.K5(6);break}g.pp(KB,7);return g.e(KB,LsU(0,!!w,!0,r),9);case 9:n=KB.L;g.Ix(KB,8);break;case 7:M=g.DX(KB);if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&ZE(M.message);KB.K5(8);break}return O==="!*$_ALL_ENTITIES_!*$"?g.e(KB,B5N(v.W,F,v.D,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.e(KB,cEd(O,v.W,F,v.D),8);case 8:if(!n.length||!p&&n[0].playlistId!==O)return KB.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K));case 6:if(p){J=[];f=g.P(n);for(u=f.next();!u.done;u=f.next())t=u.value,t.upToDate||w&&!t.shouldAutoSyncMetadata||!t.playlistId||(g_={nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:w},J.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,Au,{mainPlaylistEntityActionMetadata:g_})));return KB.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,J))}n.length&&(F_=n[0],X=!!F_.upToDate,w&&(V=(xe=F_.shouldAutoSyncMetadata)!=null?xe:!0,h=(QA=F_.shouldAutoSyncVideos)!=
null?QA:!0,F_.checkInSeconds&&(Y=F_.checkInSeconds)));if(X||!V)return KB.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));iU=[];KE=r[0];if(!KE.downloadState){jU=void 0;KB.K5(15);break}return g.e(KB,Hi(v.W,KE.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:jU=KB.L;case 15:return B5=jU,or=((QU=B5)==null?0:QU.addedTimestampMillis)?String(B5.addedTimestampMillis):void 0,g.pp(KB,17),g.e(KB,vy1(v,O,or,Y),19);case 19:iU=KB.L;g.Ix(KB,18);break;case 17:W5=g.DX(KB);if(!(W5 instanceof
Error&&W5.message==="No data for playlist")){if(W5 instanceof Error&&W5.message==="Empty response body for playlist")ZE(W5.message);else return qQ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Wn="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W5 instanceof g.Ng&&W5.type==="QUOTA_EXCEEDED"&&(qQ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Wn="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),KB.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,qQ,Wn));
KB.K5(18);break}return g.e(KB,cEd(O,v.W,F,v.D),18);case 18:if(!h)return KB.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));Pn=[];U=new Map;if((FQ=iU)==null?0:FQ.length)for(Gh=g.P(iU),Ts=Gh.next();!Ts.done;Ts=Gh.next())$X=Ts.value,a=$X.offlineVideoData,v5=void 0,((v5=a)==null?0:v5.videoId)&&U.set(a.videoId,a);mv=new Map;IZ=[];if((cl=KE)==null?0:(DF=cl.videos)==null?0:DF.length)for(Zc=g.P(KE.videos),xX=Zc.next();!xX.done;xX=Zc.next())if(MM=xX.value,k=JSON.parse(g.CY(MM).entityId),m=
k.videoId)U.has(m)?(mv.set(m,U.get(m)),U.delete(m)):IZ.push(m);q=Number(((R=F.actionMetadata)==null?void 0:R.priority)||0)+1;G=g.P(U.entries());for(pE=G.next();!pE.done;pE=G.next())W=pE.value,z=g.P(W),b=z.next().value,X_=z.next().value,P5=b,SU=X_,Pn.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P5,"mainVideoEntity",q,Au,FMv(F,SU,O)));Uw=g.P(mv.entries());for(Ov=Uw.next();!Ov.done;Ov=Uw.next())ke=Ov.value,AH=g.P(ke),qM=AH.next().value,Bn=AH.next().value,$e=qM,A0=Bn,Pn.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
$e,"mainVideoEntity",q,Au,FMv(F,A0,O)));JG=g.P(IZ);for(mN=JG.next();!mN.done;mN=JG.next())tG=mN.value,kT={playlistId:O},ax={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:kT},Pn.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",tG,"mainVideoEntity",0,Au,ax));return KB.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,Pn))}})},OTh=function(v,F){var K,x,O,r;
return g.y(function(p){switch(p.W){case 1:return K=Oi(F),g.pp(p,2),x=g.CY(F.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.e(p,B5N(v.W,F,v.D,(O=F.actionMetadata)==null?void 0:(r=O.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.e(p,cEd(x,v.W,F,v.D),6);case 6:if(!v.N.S("woffle_enable_main_downloads_library")){p.K5(5);break}return g.e(p,OGz(v.W,F.entityKey),5);case 5:g.Ix(p,3);break;case 2:return g.DX(p),p.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K))}})},vy1=function(v,F,K,x){var O,r,p,T,I,D,E;
return g.y(function(Y){switch(Y.W){case 1:return g.e(Y,NvX([F]),2);case 2:return O=Y.L,g.e(Y,rpp(v,O[0],K,x),3);case 3:return r=Y.L,p=r.mainPlaylistEntity,T=r.xJ6,D=G5U(p,(I=T)==null?void 0:I.avatar),g.pp(Y,4),g.e(Y,nC(D),6);case 6:g.Ix(Y,5);break;case 4:E=g.DX(Y),E instanceof Error&&E.message==="Failed to fetch"&&ZE(E.message);case 5:return Y.return(O[0].videos)}})},rpp=function(v,F,K,x){var O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f;
return g.y(function(u){switch(u.W){case 1:O=Date.now().toString();K||(K=O);r=F.videos;p=F.playlistId;T=[];I=[];if(r)for(D=g.P(r),E=D.next();!E.done;E=D.next()){Y=E.value;N=Y.offlineVideoData;if(!N||!N.videoId)throw ZE("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");w=N.videoId;n={videoId:w,playlistId:p};V={id:g.zc(JSON.stringify(n),"mainPlaylistVideoEntity"),video:g.zc(w,"mainVideoEntity")};T.push(V);I.push(V.id)}X={key:g.zc(p,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:K,lastSyncedTimestampMillis:O};M={key:g.zc(p,"mainPlaylistEntity"),playlistId:p,videos:I,title:F.title,thumbnailStyleData:pQU(F),visibility:Qlv(F),downloadState:X.key};F.channel&&(J=F.channel.offlineChannelData,h=ToA(g.zc(p,"ytMainChannelEntity"),J),M.channelOwner=h.id);((f=M)==null?0:f.entityMetadata)?(M.entityMetadata.offlineLastModifiedTimestampSeconds=F.lastModifiedTimestamp,x&&(M.entityMetadata.nextAutoRefreshIntervalSeconds=String(x))):M&&(M.entityMetadata={nextAutoRefreshIntervalSeconds:x?
String(x):void 0,offlineLastModifiedTimestampSeconds:F.lastModifiedTimestamp});g.pp(u,2);return g.e(u,CA(v.W,{mode:"readwrite",X$:!0},function(t){var g_=o3(t,M,"mainPlaylistEntity"),F_=o3(t,X,"mainPlaylistDownloadStateEntity");g_=[g_,F_];F_=g.P(T);for(var xe=F_.next();!xe.done;xe=F_.next())g_.push(o3(t,xe.value,"mainPlaylistVideoEntity"));h&&g_.push(o3(t,h,"ytMainChannelEntity"));return g.mK.all(g_)}),4);
case 4:g.Ix(u,3);break;case 2:throw g.DX(u),ZE("PES failure for playlist"),Error("PES failure for playlist");case 3:return u.return({mainPlaylistEntity:M,xJ6:h,vOZ:T})}})},ToA=function(v,F){return{id:v,
channelId:F.channelId,title:F.title,avatar:F.thumbnail}},pQU=function(v){var F=[],K=v.videos;
K&&K.length>0&&F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:K[0].offlineVideoData.thumbnail}}});if((v=v.additionalMetadadatas)&&v.length>0)for(v=g.P(v),K=v.next();!K.done;K=v.next()){var x=K.value.offlineBundleItemPlaylistData,O=void 0;K=(O=x)==null?void 0:O.style;O=void 0;x={collageThumbnail:{coverThumbnail:(O=x)==null?void 0:O.coverThumbnail}};switch(K){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:x});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:x})}}return F},Qlv=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},FMv=function(v,F,K){F={offlineVideoData:F,
playlistId:K};if(v=g.S(v.actionMetadata,xPX))F.maximumDownloadQuality=v.maximumDownloadQuality;return{mainVideoEntityActionMetadata:F}},Iwz=function(v,F,K){this.W=v;
this.N=F;this.D=K},iTz=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n;
return g.y(function(V){switch(V.W){case 1:return K=Oi(F),x=g.CY(F.entityKey),O=x.entityId,r=g.S(F.actionMetadata,CC),T=!((p=r)==null?0:p.playlistId),g.pp(V,2),g.e(V,DPX(v,O,void 0,(I=r)==null?void 0:I.offlineVideoData,T),4);case 4:g.Ix(V,3);break;case 2:return D=g.DX(V),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.Ng&&D.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,E,Y));case 3:N=1;N=Number(((w=F.actionMetadata)==null?void 0:w.priority)||0)+1;var h=(h=g.S(F.actionMetadata,CC))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;n=Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"playbackData",N,EyX,h);return V.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,[n]))}})},YhA=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M;
return g.y(function(J){switch(J.W){case 1:return K=Oi(F),x=g.CY(F.entityKey),O=x.entityId,g.e(J,Hi(v.W,F.entityKey,"mainVideoEntity"),2);case 2:r=J.L;if(!r){p=void 0;J.K5(3);break}return g.e(J,Hi(v.W,r.downloadState,"mainVideoDownloadStateEntity"),4);case 4:p=J.L;case 3:T=p;if(!r||!T)return J.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));g.pp(J,5);return g.e(J,DPX(v,O,T.addedTimestampMillis,(D=g.S(F.actionMetadata,CC))==null?void 0:D.offlineVideoData),7);case 7:E=1;E=Number(((Y=
F.actionMetadata)==null?void 0:Y.priority)||0)+1;I=Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O,"playbackData",E,EyX);g.Ix(J,6);break;case 5:N=g.DX(J);if(!(N instanceof Error&&N.message==="No data")){if(N instanceof Error&&N.message==="Empty response body")ZE(N.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.Ng&&N.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),J.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,w,n));J.K5(6);break}return g.e(J,dQ(v.W,O),9);case 9:V=J.L;h=g.S(F.actionMetadata,CC);if(M=(X=h)==null?void 0:X.playlistId)V.playlistId=M;V.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.e(J,LC(O,v.W,F,v.D,V),6);case 6:return J.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,I?[I]:void 0))}})},wQd=function(v,F){var K,x,O,r,p,T,I,D,E,Y;
return g.y(function(N){switch(N.W){case 1:return K=Oi(F),g.pp(N,2),x=g.CY(F.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.e(N,B5N(v.W,F,v.D,(E=F.actionMetadata)==null?void 0:(Y=E.offlineLoggingData)==null?void 0:Y.offlineDeleteReason),5):g.e(N,dQ(v.W,x),6);case 6:O=N.L;r=g.S(F.actionMetadata,CC);if(T=(p=r)==null?void 0:p.playlistId)O.playlistId=T;O.offlineDeleteReason=(I=F.actionMetadata)==null?void 0:(D=I.offlineLoggingData)==null?void 0:D.offlineDeleteReason;return g.e(N,LC(x,v.W,F,v.D,O),7);
case 7:if(!v.N.S("woffle_enable_main_downloads_library")){N.K5(5);break}return g.e(N,OGz(v.W,F.entityKey),5);case 5:g.Ix(N,3);break;case 2:return g.DX(N),N.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K))}})},DPX=function(v,F,K,x,O){var r,p,T,I,D,E;
return g.y(function(Y){switch(Y.W){case 1:if(r=x){Y.K5(2);break}return g.e(Y,wAA([F]),3);case 3:p=Y.L,r=p[0];case 2:return g.e(Y,Nox(v,r,K,O),4);case 4:T=Y.L;I=T.mainVideoEntity;D=T.channelEntity;g.pp(Y,5);var N=Ei(I.thumbnail),w=Ei(D.avatar);return g.e(Y,nC(N.concat(w)),7);case 7:g.Ix(Y,0);break;case 5:E=g.DX(Y),E instanceof Error&&E.message==="Failed to fetch"&&ZE(E.message),g.rd(Y)}})},Nox=function(v,F,K,x){var O,r,p,T,I,D,E,Y,N,w,n,V,h;
return g.y(function(X){switch(X.W){case 1:K||(K=Date.now().toString());r=(O=F.channel)==null?void 0:O.offlineChannelData;p={id:g.zc(F.videoId,"ytMainChannelEntity"),channelId:r.channelId,title:r.title,avatar:r.thumbnail};T={key:g.zc(F.videoId,"mainVideoDownloadStateEntity"),playbackData:g.zc(F.videoId,"playbackData"),addedTimestampMillis:K,videoDownloadContextEntity:g.zc(F.videoId,"videoDownloadContextEntity")};I={key:g.zc(F.videoId,"videoPlaybackPositionEntity"),videoId:F.videoId,lastPlaybackPositionSeconds:"0"};
v.N.S("html5_offline_playback_position_sync")&&(D={playbackPosition:I.key});E=g.zc(F.videoId,"mainVideoEntity");Y={key:E,videoId:F.videoId,title:F.title,thumbnail:F.thumbnail,localizedStrings:{viewCount:F.shortViewCountText},userState:D,lengthSeconds:F.lengthSeconds?Number(F.lengthSeconds):void 0,publishedTimestampMillis:F.publishedTimestamp?(Number(F.publishedTimestamp)*1E3).toString():void 0,formattedDescription:F.description,owner:p.id,downloadState:T.key};if(!v.N.S("woffle_enable_main_downloads_library")||
!x){X.K5(2);break}return g.e(X,xEv(v.W,[E]),3);case 3:if(n=X.L)N=n.mainDownloadsLibraryEntity,w=n.mainDownloadsListEntity;case 2:return h=tqp,V={key:g.zc(F.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.qL(T,h,V),g.e(X,CA(v.W,{mode:"readwrite",X$:!0},function(M){var J=o3(M,p,"ytMainChannelEntity"),f=o3(M,T,"mainVideoDownloadStateEntity"),u=o3(M,Y,"mainVideoEntity");J=[J,f,u];v.N.S("html5_offline_playback_position_sync")&&(f=o3(M,I,"videoPlaybackPositionEntity"),
J.push(f));N&&(f=o3(M,N,"mainDownloadsLibraryEntity"),J.push(f));w&&(f=o3(M,w,"mainDownloadsListEntity"),J.push(f));V&&(M=o3(M,V,"downloadStatusEntity"),J.push(M));return g.mK.all(J)}),4);
case 4:return X.return({mainVideoEntity:Y,channelEntity:p})}})},nyv=function(v,F,K){this.W=v;
this.N=F;this.D=K},ShM=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE;
return g.y(function(jU){switch(jU.W){case 1:return K=Oi(F),x=[],g.e(jU,lo.getInstance(),2);case 2:O=jU.L;if(!O){jU.K5(3);break}return g.e(jU,O.get("sdois"),4);case 4:return r=jU.L,g.e(jU,(T=O)==null?void 0:T.get("lmqf"),5);case 5:p=jU.L;case 3:g.pp(jU,6);if(r===void 0)throw Error("prefStorage or opt-in state is undefined");I=[];if(r){jU.K5(8);break}return g.e(jU,Ksh(v.W),9);case 9:I=jU.L,I.reverse();case 8:if(!I.length){jU.K5(10);break}D=g.P(I);E=D.next();case 11:if(E.done){jU.K5(10);break}Y=E.value;
if(!Y){jU.K5(12);break}N=g.CY(Y).entityId;return g.e(jU,dQ(v.W,N),14);case 14:return w=jU.L,w.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.e(jU,LC(N,v.W,{entityKey:Y,actionType:F.actionType},v.D,w),12);case 12:E=D.next();jU.K5(11);break;case 10:return g.e(jU,dEX(r,(n=p)!=null?n:"SD"),16);case 16:return V=jU.L,g.e(jU,Z_x(V),17);case 17:h=FsU(V);if(!v.N.S("woffle_enable_main_downloads_library")){jU.K5(18);break}if(r){jU.K5(19);break}return g.e(jU,OGz(v.W,g.$J),19);case 19:return g.e(jU,
gIX(v.W,[g.$J]),18);case 18:if((X=h)==null?0:X.length)for(M=g.P(h),J=M.next();!J.done;J=M.next())if(u=f=J.value,t=u.actionType,g_=u.entityKey,F_=u.actionMetadata,t&&g_&&F_&&!g.S(F_,LMv)){t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(F_.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(xe=g.S(f.actionMetadata,CC))xe.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",f.actionMetadata=Object.assign({},f.actionMetadata,{mainVideoEntityActionMetadata:xe});x.push(f)}g.Ix(jU,
7);break;case 6:return QA=g.DX(jU),iU="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",KE="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",QA instanceof g.Ng&&QA.type==="QUOTA_EXCEEDED"&&(iU="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",KE="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jU.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,iU,KE));case 7:return jU.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,x))}})},dPz=function(){tu.apply(this,
arguments);
this.tP="mainVideoEntity"},VfA=function(v,F,K){F=F===void 0?43200:F;
K=K===void 0?!0:K;var x=x===void 0?!1:x;var O,r,p;return g.y(function(T){switch(T.W){case 1:if(!v.j.C7())return T.return([]);O=[];g.pp(T,2);return g.e(T,LsU(F,K,x),4);case 4:O=T.L;g.Ix(T,3);break;case 2:r=g.DX(T),r instanceof Error&&r.message==="No data"||r instanceof Error&&r.message==="Empty response body"&&ZE(r.message);case 3:return p=W7M(v,O,K,"mainPlaylistEntity"),T.return(p)}})},jlp=function(v,F,K,x){x=x===void 0?!1:x;
var O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M;return g.y(function(J){switch(J.W){case 1:return O=[],g.e(J,S11(),2);case 2:return(r=J.L)||x?g.e(J,V9A(F,K),3):J.return([]);case 3:p=J.L;if((T=p)==null||!T.length)return J.return([]);I={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};D=g.P(p);E=D.next();case 4:if(E.done){J.K5(6);break}N=Y=E.value;w=N.actionType;n=N.entityKey;V=N.actionMetadata;if(!(w&&n&&V)||g.S(V,LMv)){J.K5(5);break}w==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(V.offlineLoggingData=
I);h=g.CY(n);X=h.entityId;return g.e(J,uV(v,[X],"mainVideoEntity",w,V),8);case 8:M=J.L,O=O.concat(M);case 5:E=D.next();J.K5(4);break;case 6:return J.return(O)}})},mPX=function(v,F){this.W=v;
this.D=F},awN=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X;
return g.y(function(M){switch(M.W){case 1:return K=Oi(F),x=g.CY(F.entityKey),O=x.entityId,r=[],g.pp(M,2),g.e(M,hXv(v,O),4);case 4:r=M.L;if((p=r)==null||!p.length){M.K5(5);break}return g.e(M,IMX(v.W,F.entityKey),5);case 5:g.Ix(M,3);break;case 2:return T=g.DX(M),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Ng&&T.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,I,D));case 3:return E=[],g.e(M,uex(v.W,"musicTrack",r),7);case 7:r=M.L;if(r.length)for(Y=g.P(r),N=Y.next();!N.done;N=Y.next())if(w=N.value,n=w.offlineVideoData,V=void 0,(V=n)==null?0:V.videoId)h=void 0,X=Number(((h=F.actionMetadata)==null?void 0:h.priority)||0)+1,E.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n.videoId,"musicTrack",X,zb,hu(F,n,O)));return M.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,E))}})},
RXd=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn,Pn,U,FQ,Gh,Ts,$X,a,v5,mv,IZ,cl,DF,Zc,xX,MM,k,m,R,q,G,pE,W,z,b,X_;
return g.y(function(P5){switch(P5.W){case 1:return K=Oi(F),x=F.entityKey,O=g.CY(x).entityId,r=[],p=!1,O==="!*$_ALL_ENTITIES_!*$"?(p=!0,g.e(P5,GR(v.W,"musicAlbumRelease"),5)):g.e(P5,Hi(v.W,x,"musicAlbumRelease"),4);case 4:(T=P5.L)&&r.push(T);P5.K5(3);break;case 5:r=P5.L;case 3:if((I=r)==null||!I.length)return P5.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));if(p){D=[];E=g.P(r);for(Y=E.next();!Y.done;Y=E.next())N=Y.value,w=g.CY(N.id).entityId,D.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
w,"musicAlbumRelease",0,zb));return P5.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,D))}n=[];V=r[0];h=void 0;if(!V.downloadMetadata){P5.K5(6);break}return g.e(P5,Hi(v.W,V.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:X=P5.L,h=Number((J=(M=X)==null?void 0:M.addedTimestampMillis)!=null?J:"0")/1E3;case 6:return g.pp(P5,8),g.e(P5,hXv(v,O,(f=h)==null?void 0:f.toString()),10);case 10:n=P5.L;g.Ix(P5,9);break;case 8:u=g.DX(P5);if(!(u instanceof Error&&u.message===
"No data")){if(u instanceof Error&&u.message==="Empty response body")ZE(u.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",g_="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.Ng&&u.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",g_="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P5.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,t,g_));P5.K5(9);break}return g.e(P5,j1(O,"musicAlbumRelease",
v.W,F,v.D),9);case 9:F_=[];xe=new Map;if((QA=n)==null?0:QA.length)for(iU=g.P(n),KE=iU.next();!KE.done;KE=iU.next())jU=KE.value,B5=jU.offlineVideoData,QU=void 0,((QU=B5)==null?0:QU.videoId)&&xe.set(B5.videoId,B5);or=new Map;W5=[];if((qQ=V)==null?0:(Wn=qQ.tracks)==null?0:Wn.length)for(Pn=g.P(V.tracks),U=Pn.next();!U.done;U=Pn.next())if(FQ=U.value,Gh=g.CY(FQ).entityId)xe.has(Gh)?(or.set(Gh,xe.get(Gh)),xe.delete(Gh)):W5.push(Gh);$X=Number(((Ts=F.actionMetadata)==null?void 0:Ts.priority)||0)+1;a=g.P(xe.entries());
for(v5=a.next();!v5.done;v5=a.next())mv=v5.value,IZ=g.P(mv),cl=IZ.next().value,DF=IZ.next().value,Zc=cl,xX=DF,F_.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Zc,"musicTrack",$X,zb,hu(F,xX)));MM=g.P(or.entries());for(k=MM.next();!k.done;k=MM.next())m=k.value,R=g.P(m),q=R.next().value,G=R.next().value,pE=q,W=G,F_.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",pE,"musicTrack",$X,zb,hu(F,W)));z=g.P(W5);for(b=z.next();!b.done;b=z.next())X_=b.value,F_.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
X_,"musicTrack",0,zb));return P5.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,F_))}})},kIp=function(v,F){var K,x;
return g.y(function(O){switch(O.W){case 1:return K=Oi(F),g.pp(O,2),x=g.CY(F.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.e(O,m4(v.W,F,v.D),5):g.e(O,j1(x,"musicAlbumRelease",v.W,F,v.D),6);case 6:return g.e(O,DEz(v.W,F.entityKey),5);case 5:g.Ix(O,3);break;case 2:return g.DX(O),O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K))}})},hXv=function(v,F,K){var x,O,r;
return g.y(function(p){switch(p.W){case 1:return g.e(p,NvX([F]),2);case 2:return x=p.L,g.e(p,MfA(v,x[0],K),3);case 3:return O=p.L,r=Ei(O.thumbnailDetails),g.e(p,nC(r),4);case 4:return p.return(x[0].videos)}})},MfA=function(v,F,K){var x,O,r,p,T,I,D,E,Y,N,w,n,V,h;
return g.y(function(X){if(X.W==1){x=F.additionalMetadadatas;O=void 0;if(x&&x.length>0)for(r=g.P(x),p=r.next();!p.done;p=r.next())if(T=p.value,T.offlineMusicPlaylistData){O=T.offlineMusicPlaylistData;break}I=F.playlistId;D=EIv(F);E=D.Ey;Y=D.AR;N=K?(Number(K)*1E3).toString():Date.now().toString();w=F.lastModifiedTimestamp?(Number(F.lastModifiedTimestamp)*1E3).toString():"0";n={id:g.zc(I,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:Y,lastModifiedTimestampMillis:w,addedTimestampMillis:N,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};V={id:g.zc(I,"musicAlbumRelease"),title:F.title,audioPlaylistId:I,trackCount:F.totalVideoCount,tracks:E,downloadMetadata:n.id};O&&(V.thumbnailDetails=(h=O.albumHqThumbnail)!=null?h:O.albumArtistThumbnail,V.artistDisplayName=O.albumArtistDisplayName,V.releaseDate=O.albumReleaseDate,V.contentRating={explicitType:O.albumReleaseExplicitType},V.releaseType=O.albumReleaseType);return g.e(X,CA(v.W,{mode:"readwrite",X$:!0},function(M){var J=o3(M,V,"musicAlbumRelease");
M=o3(M,n,"musicAlbumReleaseDownloadMetadataEntity");return g.mK.all([J,M])}),2)}return X.return(V)})},UPn=function(v,F){this.W=v;
this.D=F},XQz=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X;
return g.y(function(M){switch(M.W){case 1:return K=Oi(F),x=g.CY(F.entityKey),O=x.entityId,r=[],g.pp(M,2),g.e(M,$Pd(v,O),4);case 4:r=M.L;if((p=r)==null||!p.length){M.K5(5);break}return g.e(M,IMX(v.W,F.entityKey),5);case 5:g.Ix(M,3);break;case 2:return T=g.DX(M),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Ng&&T.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,I,D));case 3:return E=[],g.e(M,uex(v.W,"musicTrack",r),7);case 7:r=M.L;if(r.length)for(Y=g.P(r),N=Y.next();!N.done;N=Y.next())if(w=N.value,n=w.offlineVideoData,V=void 0,(V=n)==null?0:V.videoId)h=void 0,X=Number(((h=F.actionMetadata)==null?void 0:h.priority)||0)+1,E.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n.videoId,"musicTrack",X,HG,hu(F,n,O)));return M.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,E))}})},
PRh=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn,Pn,U,FQ,Gh,Ts,$X,a,v5,mv,IZ,cl,DF,Zc,xX,MM,k,m,R,q,G,pE,W,z,b,X_,P5,SU,Uw,Ov,ke,AH,qM,Bn,$e,A0,JG,mN;
return g.y(function(tG){switch(tG.W){case 1:return K=Oi(F),x=F.entityKey,O=g.CY(x).entityId,r=[],p=!1,O==="!*$_ALL_ENTITIES_!*$"?(p=!0,g.e(tG,GR(v.W,"musicPlaylist"),5)):g.e(tG,Hi(v.W,x,"musicPlaylist"),4);case 4:(T=tG.L)&&r.push(T);tG.K5(3);break;case 5:r=tG.L;case 3:if((I=r)==null||!I.length)return tG.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));D=g.S(F.actionMetadata,iGU);Y=(E=D)==null?void 0:E.autoSync;N=[];n=w=!0;V=!1;h=void 0;if(!p&&Y===!1){tG.K5(6);break}g.pp(tG,7);return g.e(tG,
j7U(0,!!Y,!0,r),9);case 9:N=tG.L;g.Ix(tG,8);break;case 7:X=g.DX(tG);if(!(X instanceof Error&&X.message==="No data")){X instanceof Error&&X.message==="Empty response body"&&ZE(X.message);tG.K5(8);break}return O==="!*$_ALL_ENTITIES_!*$"?g.e(tG,m4(v.W,F,v.D),8):g.e(tG,j1(O,"musicPlaylist",v.W,F,v.D),8);case 8:if(!N.length||!p&&N[0].playlistId!==O)return tG.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));case 6:if(p){M=[];J=g.P(N);for(f=J.next();!f.done;f=J.next())u=f.value,u.upToDate||
Y&&!u.shouldAutoSyncMetadata||!u.playlistId||(t={autoSync:Y},M.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",u.playlistId,"musicPlaylist",0,HG,{musicPlaylistEntityActionMetadata:t})));return tG.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,M))}N.length&&(g_=N[0],V=!!g_.upToDate,Y&&(w=(F_=g_.shouldAutoSyncMetadata)!=null?F_:!0,n=(xe=g_.shouldAutoSyncVideos)!=null?xe:!0,g_.checkInSeconds&&(h=g_.checkInSeconds)));if(V||!w)return tG.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K));QA=[];iU=r[0];KE=void 0;if(!iU.downloadMetadata){tG.K5(15);break}return g.e(tG,Hi(v.W,iU.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:jU=tG.L,KE=Number((QU=(B5=jU)==null?void 0:B5.addedTimestampMillis)!=null?QU:"0")/1E3;case 15:return g.pp(tG,17),g.e(tG,$Pd(v,O,(or=KE)==null?void 0:or.toString(),h),19);case 19:QA=tG.L;g.Ix(tG,18);break;case 17:W5=g.DX(tG);if(!(W5 instanceof Error&&W5.message==="No data")){if(W5 instanceof Error&&W5.message==="Empty response body")ZE(W5.message);
else return qQ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Wn="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W5 instanceof g.Ng&&W5.type==="QUOTA_EXCEEDED"&&(qQ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Wn="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tG.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,qQ,Wn));tG.K5(18);break}return g.e(tG,j1(O,"musicPlaylist",v.W,F,v.D),18);case 18:if(!n)return tG.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K));Pn=[];U=new Map;if((FQ=QA)==null?0:FQ.length)for(Gh=g.P(QA),Ts=Gh.next();!Ts.done;Ts=Gh.next())$X=Ts.value,a=$X.offlineVideoData,v5=void 0,((v5=a)==null?0:v5.videoId)&&U.set(a.videoId,a);mv=new Map;IZ=[];if((cl=iU)==null?0:(DF=cl.tracks)==null?0:DF.length)for(Zc=g.P(iU.tracks),xX=Zc.next();!xX.done;xX=Zc.next())if(MM=xX.value,k=g.CY(MM).entityId)U.has(k)?(mv.set(k,U.get(k)),U.delete(k)):IZ.push(k);R=Number(((m=F.actionMetadata)==null?void 0:m.priority)||0)+1;q=g.P(U.entries());for(G=q.next();!G.done;G=
q.next())pE=G.value,W=g.P(pE),z=W.next().value,b=W.next().value,X_=z,P5=b,Pn.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",X_,"musicTrack",R,HG,hu(F,P5)));SU=g.P(mv.entries());for(Uw=SU.next();!Uw.done;Uw=SU.next())Ov=Uw.value,ke=g.P(Ov),AH=ke.next().value,qM=ke.next().value,Bn=AH,$e=qM,Pn.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Bn,"musicTrack",R,HG,hu(F,$e)));A0=g.P(IZ);for(JG=A0.next();!JG.done;JG=A0.next())mN=JG.value,Pn.push(Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",mN,"musicTrack",
0,HG));return tG.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,Pn))}})},JpM=function(v,F){var K,x;
return g.y(function(O){switch(O.W){case 1:return K=Oi(F),g.pp(O,2),x=g.CY(F.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.e(O,m4(v.W,F,v.D),5):g.e(O,j1(x,"musicPlaylist",v.W,F,v.D),6);case 6:return g.e(O,DEz(v.W,F.entityKey),5);case 5:g.Ix(O,3);break;case 2:return g.DX(O),O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K))}})},$Pd=function(v,F,K,x){var O,r,p;
return g.y(function(T){switch(T.W){case 1:return g.e(T,NvX([F]),2);case 2:return O=T.L,g.e(T,lwn(v,O[0],K,x),3);case 3:return r=T.L,p=Ei(r.thumbnailDetails),g.e(T,nC(p),4);case 4:return T.return(O[0].videos)}})},lwn=function(v,F,K,x){var O,r,p,T,I,D,E,Y,N;
return g.y(function(w){return w.W==1?(O=F.playlistId,r=EIv(F),p=r.Ey,T=r.AR,I=K?(Number(K)*1E3).toString():Date.now().toString(),D=F.lastModifiedTimestamp?(Number(F.lastModifiedTimestamp)*1E3).toString():"0",E={id:g.zc(O,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:T,lastModifiedTimestampMillis:D,addedTimestampMillis:I,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},Y={id:g.zc(O,"musicPlaylist"),title:F.title,playlistId:O,thumbnailDetails:F.thumbnail,visibility:fwU(F),trackCount:F.totalVideoCount,
tracks:p,downloadMetadata:E.id},x&&(((N=Y)==null?0:N.entityMetadata)?Y.entityMetadata.nextAutoRefreshIntervalSeconds=String(x):Y&&(Y.entityMetadata={nextAutoRefreshIntervalSeconds:String(x)})),g.e(w,CA(v.W,{mode:"readwrite",X$:!0},function(n){var V=o3(n,Y,"musicPlaylist");n=o3(n,E,"musicPlaylistDownloadMetadataEntity");return g.mK.all([V,n])}),2)):w.return(Y)})},fwU=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},qhN=function(v,F){this.W=v;
this.D=F},oyU=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n;
return g.y(function(V){switch(V.W){case 1:return K=Oi(F),x=g.CY(F.entityKey),O=x.entityId,r=g.S(F.actionMetadata,eXn),g.pp(V,2),g.e(V,bTv(v,O,void 0,(p=r)==null?void 0:p.track,(T=r)==null?void 0:T.albumRelease),4);case 4:if((I=r)==null?0:I.playlistId){V.K5(5);break}return g.e(V,IMX(v.W,F.entityKey),5);case 5:g.Ix(V,3);break;case 2:return D=g.DX(V),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.Ng&&D.type==="QUOTA_EXCEEDED"&&
(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,E,Y));case 3:w=Number(((N=F.actionMetadata)==null?void 0:N.priority)||0)+1;var h=(h=g.S(F.actionMetadata,eXn))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;n=Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"playbackData",w,yph,h);return V.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K,[n]))}})},tfA=function(v,F){var K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h;
return g.y(function(X){switch(X.W){case 1:return K=Oi(F),x=g.CY(F.entityKey),O=x.entityId,g.e(X,Hi(v.W,F.entityKey,"musicTrack"),2);case 2:r=X.L;if(!r){p=void 0;X.K5(3);break}return g.e(X,Hi(v.W,r.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:p=X.L;case 3:T=p;if(!r||!T)return X.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K));D=g.S(F.actionMetadata,eXn);g.pp(X,5);return g.e(X,bTv(v,O,T.addedTimestampMillis,(E=D)==null?void 0:E.track,(Y=D)==null?void 0:Y.albumRelease),
7);case 7:w=Number(((N=F.actionMetadata)==null?void 0:N.priority)||0)+1;I=Mb("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O,"playbackData",w,yph);g.Ix(X,6);break;case 5:n=g.DX(X);if(!(n instanceof Error&&n.message==="No data")){if(n instanceof Error&&n.message==="Empty response body")ZE(n.message);else return V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.Ng&&n.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),X.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,V,h));X.K5(6);break}return g.e(X,VW(O,v.W,F,v.D),6);case 6:return X.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",K,I?[I]:void 0))}})},udn=function(v,F){var K,x;
return g.y(function(O){switch(O.W){case 1:return K=Oi(F),g.pp(O,2),x=g.CY(F.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.e(O,m4(v.W,F,v.D),5):g.e(O,VW(x,v.W,F,v.D),6);case 6:return g.e(O,DEz(v.W,F.entityKey),5);case 5:g.Ix(O,3);break;case 2:return g.DX(O),O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",K,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new Ui("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
K))}})},bTv=function(v,F,K,x,O){var r,p,T,I,D,E;
return g.y(function(Y){switch(Y.W){case 1:if(r=x){Y.K5(2);break}return g.e(Y,wAA([F]),3);case 3:p=Y.L,T=p[0],r=Tvz(T);case 2:return g.e(Y,ApU(v,r,F,O,K),4);case 4:I=Y.L;D=I.musicTrackEntity;E=I.Kj;var N=Ei(D.thumbnailDetails),w=[];E&&(w=Ei(E.thumbnailDetails));return g.e(Y,nC(N.concat(w)),0)}})},ApU=function(v,F,K,x,O){var r;
return g.y(function(p){return p.W==1?(O||(O=Date.now().toString()),r={id:g.zc(K,"musicTrackDownloadMetadataEntity"),playbackData:g.zc(K,"playbackData"),addedTimestampMillis:O,videoDownloadContextEntity:g.zc(K,"videoDownloadContextEntity")},x&&(F.albumRelease=x.id),g.e(p,CA(v.W,{mode:"readwrite",X$:!0},function(T){var I=[],D=o3(T,r,"musicTrackDownloadMetadataEntity");I.push(D);D=o3(T,F,"musicTrack");I.push(D);x&&(T=o3(T,x,"musicAlbumRelease"),I.push(T));return g.mK.all(I)}),2)):p.W!=3?g.e(p,Tb(K,"musicTrackDownloadMetadataEntity",
v.W,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):p.return({musicTrackEntity:F,
Kj:x})})},Gb=function(){tu.apply(this,arguments);
this.tP="musicTrack"},CRA=function(v,F,K){F=F===void 0?43200:F;
K=K===void 0?!0:K;var x=x===void 0?!1:x;var O,r;return g.y(function(p){switch(p.W){case 1:if(!v.j.C7())return p.return([]);O=[];g.pp(p,2);return g.e(p,j7U(F,K,x),4);case 4:O=p.L;g.Ix(p,3);break;case 2:g.DX(p);case 3:return r=W7M(v,O,K,"musicPlaylist"),p.return(r)}})},zXU=function(){g.DN.apply(this,arguments);
var v=this;this.events=new g.Em(this);this.N=this.player.U();this.VR={x8q:function(){return v.W},
PZ:function(){return v.PZ()},
C1:function(F){return v.C1(F)}}},HTn=function(v){var F;
v=g.S((F=v.getWatchNextResponse())==null?void 0:F.currentVideoEndpoint,g.DS);if(v==null?0:v.playlistId)var K=v.playlistId;return K},GIx=function(v,F){var K,x,O,r;
return g.y(function(p){if(p.W==1){K=F.clientPlaybackNonce;x={cpn:K,offlineSourceVisualElement:g.nv(F.qb||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};F.L&&(x.videoFmt=Number(F.L.itag));F.G&&(x.audioFmt=Number(F.G.itag));if((O=HTn(F))&&F.videoId){var T=F.videoId;T=O!=="PPSV"?Promise.resolve(!1):v.W.NA(T);p=g.e(p,T,3)}else p=p.K5(2);return p}p.W!=2&&(r=p.L)&&(x.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");v.L=K;g.wZ("offlinePlaybackStarted",x);g.rd(p)})};
g.PO.prototype.FO=g.bU(41,function(v){return this.app.FO(v)});
g.Di.prototype.FO=g.bU(40,function(v){return g.AJG(this,9,v)});
g.d(Pi,XN);g.CE.Object.defineProperties(Pi.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.W.entityMetadata},
set:function(v){this.W.entityMetadata=v}}});
g.d(lnp,Pi);lnp.prototype.L=function(){return[]};
g.d(fnU,Pi);fnU.prototype.L=function(){return[]};
g.d(qaM,Pi);qaM.prototype.L=function(){return[]};
g.d(ebd,Pi);ebd.prototype.L=function(){return[]};
g.d(btN,Pi);btN.prototype.L=function(){return[]};
g.d(yZU,Pi);yZU.prototype.L=function(){var v=[];this.W.alternateChannel&&v.push(this.W.alternateChannel);this.W.alternateChannelList&&v.push.apply(v,g.l(this.W.alternateChannelList));this.W.oneofChannelEntity&&v.push(this.W.oneofChannelEntity);return[].concat(g.l(new Set(v)))};
g.d(o8z,Pi);o8z.prototype.L=function(){var v=[];this.W.entryCollection&&v.push(this.W.entryCollection);return[].concat(g.l(new Set(v)))};
g.d(tOn,XN);tOn.prototype.L=function(){var v=[];this.W.video&&v.push(this.W.video);return[].concat(g.l(new Set(v)))};
g.d(ukU,Pi);ukU.prototype.L=function(){var v=[];this.W.parentPlaylist&&v.push(this.W.parentPlaylist);if(this.W.entries)for(var F=g.P(this.W.entries),K=F.next();!K.done;K=F.next())v.push.apply(v,g.l((new tOn(K.value)).L()));return[].concat(g.l(new Set(v)))};
g.d(AZn,Pi);AZn.prototype.L=function(){var v=[];this.W.descriptionEntity&&v.push(this.W.descriptionEntity);this.W.creators&&v.push.apply(v,g.l(this.W.creators));this.W.theBiggestFan&&v.push(this.W.theBiggestFan);return[].concat(g.l(new Set(v)))};
g.d(CIn,Pi);CIn.prototype.L=function(){return[]};
g.d(zbd,Pi);zbd.prototype.L=function(){return[]};
g.d(HtM,Pi);HtM.prototype.L=function(){return[]};
g.d(GAN,Pi);GAN.prototype.L=function(){return[]};
g.d(s0d,Pi);s0d.prototype.L=function(){return[]};
g.d(cZN,Pi);cZN.prototype.L=function(){return[]};
g.d(Wqz,Pi);Wqz.prototype.L=function(){return[]};
g.d(BFp,Pi);BFp.prototype.L=function(){return[]};
g.d(Ztn,Pi);Ztn.prototype.L=function(){return[]};
g.d(vSp,Pi);vSp.prototype.L=function(){var v=[];this.W.downloadsList&&v.push(this.W.downloadsList);this.W.smartDownloadsList&&v.push(this.W.smartDownloadsList);this.W.recommendedDownloadsList&&v.push(this.W.recommendedDownloadsList);this.W.refresh&&v.push(this.W.refresh);return[].concat(g.l(new Set(v)))};
g.d(FAv,XN);FAv.prototype.L=function(){var v=[];this.W.video&&v.push(this.W.video);this.W.playlist&&v.push(this.W.playlist);this.W.videoItem&&v.push(this.W.videoItem);this.W.playlistItem&&v.push(this.W.playlistItem);return[].concat(g.l(new Set(v)))};
g.d(KAA,Pi);KAA.prototype.L=function(){var v=[];this.W.refresh&&v.push(this.W.refresh);if(this.W.downloads)for(var F=g.P(this.W.downloads),K=F.next();!K.done;K=F.next())v.push.apply(v,g.l((new FAv(K.value)).L()));return[].concat(g.l(new Set(v)))};
g.d(xoN,Pi);xoN.prototype.L=function(){var v=[];this.W.localImageEntities&&v.push.apply(v,g.l(this.W.localImageEntities));return[].concat(g.l(new Set(v)))};
g.d(gSv,Pi);gSv.prototype.L=function(){var v=[];this.W.playbackData&&v.push(this.W.playbackData);this.W.localImageEntities&&v.push.apply(v,g.l(this.W.localImageEntities));this.W.videoDownloadContextEntity&&v.push(this.W.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.d(ORM,Pi);ORM.prototype.L=function(){return[]};
g.d(rvU,Pi);rvU.prototype.L=function(){var v=[];this.W.fakeChildren&&v.push.apply(v,g.l(this.W.fakeChildren));return[].concat(g.l(new Set(v)))};
g.d(prM,Pi);prM.prototype.L=function(){var v=[];this.W.video&&v.push(this.W.video);this.W.playbackData&&v.push(this.W.playbackData);this.W.offlineVideoPolicy&&v.push(this.W.offlineVideoPolicy);return[].concat(g.l(new Set(v)))};
g.d(QwA,Pi);QwA.prototype.L=function(){return[]};
g.d(T7h,Pi);T7h.prototype.L=function(){var v=[];this.W.channelOwner&&v.push(this.W.channelOwner);this.W.videos&&v.push.apply(v,g.l(this.W.videos));this.W.collaboratorChannels&&v.push.apply(v,g.l(this.W.collaboratorChannels));this.W.downloadState&&v.push(this.W.downloadState);this.W.refresh&&v.push(this.W.refresh);return[].concat(g.l(new Set(v)))};
g.d(IgX,Pi);IgX.prototype.L=function(){var v=[];this.W.video&&v.push(this.W.video);this.W.channelContributor&&v.push(this.W.channelContributor);return[].concat(g.l(new Set(v)))};
g.d(DoX,XN);DoX.prototype.L=function(){var v=[];this.W.localImageEntities&&v.push.apply(v,g.l(this.W.localImageEntities));this.W.videoDownloadContextEntity&&v.push(this.W.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.d(ESU,XN);ESU.prototype.L=function(){var v=[];this.W.recommendedVideoMetadata&&v.push.apply(v,g.l((new DoX(this.W.recommendedVideoMetadata)).L()));return[].concat(g.l(new Set(v)))};
g.d(iRn,XN);iRn.prototype.L=function(){var v=[];this.W.playbackPosition&&v.push(this.W.playbackPosition);return[].concat(g.l(new Set(v)))};
g.d(YLU,Pi);YLU.prototype.L=function(){var v=[];this.W.owner&&v.push(this.W.owner);this.W.downloadState&&v.push(this.W.downloadState);this.W.userState&&v.push.apply(v,g.l((new iRn(this.W.userState)).L()));this.W.additionalMetadata&&v.push.apply(v,g.l((new ESU(this.W.additionalMetadata)).L()));return[].concat(g.l(new Set(v)))};
g.d(wrN,Pi);wrN.prototype.L=function(){var v=[];this.W.userChannelDetails&&v.push(this.W.userChannelDetails);return[].concat(g.l(new Set(v)))};
g.d(N7N,Pi);N7N.prototype.L=function(){var v=[];this.W.channelOwner&&v.push(this.W.channelOwner);this.W.playbackPosition&&v.push(this.W.playbackPosition);this.W.localImageEntities&&v.push.apply(v,g.l(this.W.localImageEntities));this.W.downloadStatus&&v.push(this.W.downloadStatus);return[].concat(g.l(new Set(v)))};
g.d(nSd,Pi);nSd.prototype.L=function(){return[]};
g.d(LAn,Pi);LAn.prototype.L=function(){return[]};
g.d(SLU,Pi);SLU.prototype.L=function(){return[]};
g.d(doh,Pi);doh.prototype.L=function(){return[]};
g.d(VHz,Pi);VHz.prototype.L=function(){return[]};
g.d(jwU,Pi);jwU.prototype.L=function(){return[]};
g.d(mox,Pi);mox.prototype.L=function(){return[]};
g.d(huv,Pi);huv.prototype.L=function(){return[]};
g.d(agX,Pi);agX.prototype.L=function(){return[]};
g.d(Rup,Pi);Rup.prototype.L=function(){return[]};
g.d(kFv,Pi);kFv.prototype.L=function(){return[]};
g.d(MHn,Pi);MHn.prototype.L=function(){return[]};
g.d(UoA,Pi);UoA.prototype.L=function(){return[]};
g.d($op,Pi);$op.prototype.L=function(){var v=[];this.W.compositeSourceKeys&&v.push.apply(v,g.l(this.W.compositeSourceKeys));return[].concat(g.l(new Set(v)))};
g.d(Xrx,Pi);Xrx.prototype.L=function(){var v=[];this.W.trackDownloadMetadatas&&v.push.apply(v,g.l(this.W.trackDownloadMetadatas));return[].concat(g.l(new Set(v)))};
g.d(P$x,Pi);
P$x.prototype.L=function(){var v=[];this.W.downloadedTracks&&v.push.apply(v,g.l(this.W.downloadedTracks));this.W.smartDownloadedTracks&&v.push.apply(v,g.l(this.W.smartDownloadedTracks));this.W.downloadedEpisodes&&v.push.apply(v,g.l(this.W.downloadedEpisodes));this.W.downloadedAlbumReleases&&v.push.apply(v,g.l(this.W.downloadedAlbumReleases));this.W.smartDownloadedAlbumReleases&&v.push.apply(v,g.l(this.W.smartDownloadedAlbumReleases));this.W.downloadedPlaylists&&v.push.apply(v,g.l(this.W.downloadedPlaylists));this.W.smartDownloadedPlaylists&&
v.push.apply(v,g.l(this.W.smartDownloadedPlaylists));this.W.metadataOnlyTracks&&v.push.apply(v,g.l(this.W.metadataOnlyTracks));return[].concat(g.l(new Set(v)))};
g.d(Jvn,Pi);Jvn.prototype.L=function(){var v=[];this.W.trackDownloadMetadatas&&v.push.apply(v,g.l(this.W.trackDownloadMetadatas));return[].concat(g.l(new Set(v)))};
g.d(lgh,Pi);lgh.prototype.L=function(){var v=[];this.W.playbackData&&v.push(this.W.playbackData);this.W.localImageEntities&&v.push.apply(v,g.l(this.W.localImageEntities));this.W.videoDownloadContextEntity&&v.push(this.W.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.d(fgn,Pi);fgn.prototype.L=function(){var v=[];this.W.musicLibraryStatusEntity&&v.push(this.W.musicLibraryStatusEntity);this.W.primaryArtists&&v.push.apply(v,g.l(this.W.primaryArtists));this.W.details&&v.push(this.W.details);this.W.userDetails&&v.push(this.W.userDetails);this.W.tracks&&v.push.apply(v,g.l(this.W.tracks));this.W.share&&v.push(this.W.share);this.W.downloadMetadata&&v.push(this.W.downloadMetadata);this.W.refresh&&v.push(this.W.refresh);return[].concat(g.l(new Set(v)))};
g.d(qLv,Pi);qLv.prototype.L=function(){var v=[];this.W.albumRelease&&v.push(this.W.albumRelease);this.W.tracks&&v.push.apply(v,g.l(this.W.tracks));return[].concat(g.l(new Set(v)))};
g.d(euX,Pi);euX.prototype.L=function(){var v=[];this.W.albumRelease&&v.push(this.W.albumRelease);return[].concat(g.l(new Set(v)))};
g.d(bRv,Pi);bRv.prototype.L=function(){var v=[];this.W.details&&v.push(this.W.details);this.W.userDetails&&v.push(this.W.userDetails);return[].concat(g.l(new Set(v)))};
g.d(yvN,Pi);yvN.prototype.L=function(){var v=[];this.W.parentArtist&&v.push(this.W.parentArtist);return[].concat(g.l(new Set(v)))};
g.d(oSU,Pi);oSU.prototype.L=function(){var v=[];this.W.parentArtist&&v.push(this.W.parentArtist);return[].concat(g.l(new Set(v)))};
g.d(tHU,Pi);tHU.prototype.L=function(){return[]};
g.d(uWd,Pi);uWd.prototype.L=function(){return[]};
g.d(AvU,XN);AvU.prototype.L=function(){var v=[];this.W.creatorEntity&&v.push(this.W.creatorEntity);return[].concat(g.l(new Set(v)))};
g.d(C$v,Pi);
C$v.prototype.L=function(){var v=[];this.W.tracks&&v.push.apply(v,g.l(this.W.tracks));this.W.refresh&&v.push(this.W.refresh);this.W.musicLibraryStatusEntity&&v.push(this.W.musicLibraryStatusEntity);this.W.details&&v.push(this.W.details);this.W.downloadMetadata&&v.push(this.W.downloadMetadata);this.W.sideloadMetadata&&v.push(this.W.sideloadMetadata);this.W.userDetails&&v.push(this.W.userDetails);this.W.entryCollection&&v.push(this.W.entryCollection);this.W.share&&v.push(this.W.share);this.W.podcastShowAdditionalMetadata&&v.push.apply(v,
g.l((new AvU(this.W.podcastShowAdditionalMetadata)).L()));return[].concat(g.l(new Set(v)))};
g.d(zuz,Pi);zuz.prototype.L=function(){return[]};
g.d(HRd,Pi);
HRd.prototype.L=function(){var v=[];this.W.musicLibraryStatusEntity&&v.push(this.W.musicLibraryStatusEntity);this.W.artists&&v.push.apply(v,g.l(this.W.artists));this.W.audioModeVersion&&v.push(this.W.audioModeVersion);this.W.videoModeVersion&&v.push(this.W.videoModeVersion);this.W.userDetails&&v.push(this.W.userDetails);this.W.details&&v.push(this.W.details);this.W.albumRelease&&v.push(this.W.albumRelease);this.W.share&&v.push(this.W.share);this.W.libraryEdit&&v.push(this.W.libraryEdit);this.W.downloadMetadata&&
v.push(this.W.downloadMetadata);this.W.playbackPosition&&v.push(this.W.playbackPosition);this.W.lyrics&&v.push(this.W.lyrics);return[].concat(g.l(new Set(v)))};
g.d(GFx,Pi);GFx.prototype.L=function(){var v=[];this.W.parentTrack&&v.push(this.W.parentTrack);return[].concat(g.l(new Set(v)))};
g.d(swA,Pi);swA.prototype.L=function(){var v=[];this.W.parentTrack&&v.push(this.W.parentTrack);return[].concat(g.l(new Set(v)))};
g.d(cvU,Pi);cvU.prototype.L=function(){return[]};
g.d(WAh,Pi);WAh.prototype.L=function(){return[]};
g.d(B7h,Pi);B7h.prototype.L=function(){return[]};
g.d(ZRz,Pi);ZRz.prototype.L=function(){return[]};
g.d(vu1,Pi);vu1.prototype.L=function(){var v=[];this.W.transfer&&v.push(this.W.transfer);this.W.adsPlaybackData&&v.push.apply(v,g.l(this.W.adsPlaybackData));this.W.drmLicense&&v.push(this.W.drmLicense);this.W.offlineVideoPolicy&&v.push(this.W.offlineVideoPolicy);this.W.videoDownloadContextEntity&&v.push(this.W.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.d(FYx,Pi);FYx.prototype.L=function(){return[]};
g.d(KYz,Pi);KYz.prototype.L=function(){var v=[];this.W.offlineVideoStreams&&v.push.apply(v,g.l(this.W.offlineVideoStreams));this.W.captionTrack&&v.push.apply(v,g.l(this.W.captionTrack));return[].concat(g.l(new Set(v)))};
g.d(xrp,Pi);xrp.prototype.L=function(){return[]};
g.d(gux,Pi);gux.prototype.L=function(){return[]};
g.d(Oxh,Pi);Oxh.prototype.L=function(){return[]};
g.d(rKd,Pi);rKd.prototype.L=function(){return[]};
g.d(p_d,Pi);p_d.prototype.L=function(){return[]};
g.d(QXN,Pi);QXN.prototype.L=function(){return[]};
g.d(TwA,Pi);TwA.prototype.L=function(){return[]};
g.d(IjA,Pi);IjA.prototype.L=function(){return[]};
g.d(Drn,Pi);Drn.prototype.L=function(){return[]};
g.d(Eup,Pi);Eup.prototype.L=function(){return[]};
g.d(ixd,Pi);ixd.prototype.L=function(){return[]};
g.d(YgU,Pi);YgU.prototype.L=function(){return[]};
g.d(w_1,Pi);w_1.prototype.L=function(){return[]};
g.d(NwU,Pi);NwU.prototype.L=function(){return[]};
g.d(nuX,Pi);nuX.prototype.L=function(){return[]};
g.d(LYX,Pi);LYX.prototype.L=function(){return[]};
g.d(SgX,Pi);SgX.prototype.L=function(){return[]};
g.d(dr1,Pi);dr1.prototype.L=function(){return[]};
g.d(VQn,Pi);VQn.prototype.L=function(){return[]};
g.d(jXx,Pi);jXx.prototype.L=function(){return[]};
g.d(mrU,Pi);mrU.prototype.L=function(){return[]};
g.d(hZd,Pi);hZd.prototype.L=function(){return[]};
var mEv=["browse","music/browse","streaming_browse","unplugged/browse"],M9h=["offline/playlist_sync_check"],Y1M=["offline"],hyA=["offline/offline_video_playback_position_sync"],RyA=["offline/get_playback_data_entity"],Jk;lo.getInstance=function(){return g.y(function(v){return v.return(new Promise(function(F){g.FA().then(function(K){K?(lo.instance||(lo.instance=new lo(K)),F(lo.instance)):F(void 0)})}))})};
lo.prototype.get=function(v){var F=this,K,x,O;return g.y(function(r){if(r.W==1)return g.e(r,MQv(F.token),2);if(r.W!=3)return K=r.L,g.e(r,K.get("prefs",v),3);x=r.L;if(!x)return r.return();O=(0,g.kB)();return x.expirationTimestampMs<=O?r.return():r.return(x.value)})};
lo.prototype.set=function(v,F,K){K=K===void 0?31536E3:K;var x=this,O,r,p;return g.y(function(T){if(T.W==1)return O=(0,g.kB)(),r={key:v,value:F,expirationTimestampMs:O+K*1E3},g.e(T,MQv(x.token),2);p=T.L;return g.e(T,g.lD(p,"prefs",r),0)})};
lo.prototype.remove=function(v){var F=this,K;return g.y(function(x){if(x.W==1)return g.e(x,MQv(F.token),2);K=x.L;return g.e(x,K.delete("prefs",v),0)})};
g.d(fA,g.Ye);g.d(qy,JKU);qy.prototype.D=function(v,F){F=fjU(F);v=(new TextEncoder).encode(JSON.stringify(v));return this.W.encrypt(v,F)};
qy.prototype.L=function(v,F){if(!(v instanceof Uint8Array))throw Urv(1);var K=new TextDecoder;F=fjU(F);v=this.W.decrypt(v,F);return JSON.parse(K.decode(v))};
var qgv={accountLinkStatusEntity:HtM,booleanEntity:ebd,buttonEntity:nuX,captionTrack:cvU,channelHandle:lnp,chipEntity:TwA,commerceAcquisitionClientPayloadEntity:SgX,commerceCartListEntity:dr1,compositeSourceEntity:UoA,multiviewStagingEntity:$op,contextNoteFeedEntityPayload:fnU,contextNoteUserRatingEntityPayload:qaM,continuationTokenEntity:QwA,downloadQualityPickerEntity:Wqz,downloadsPageRefreshTokenEntity:Ztn,downloadsPageViewConfigurationEntity:nSd,downloadStatusEntity:BFp,dismissState:IjA,sfvAudioItemCurrentlyPlayingEntity:rKd,
emojiFountainDataEntity:w_1,emojiCustomizationSetEntity:YgU,fakeChannel:yZU,fakePlaylist:o8z,fakePlaylistEntryCollection:ukU,fakeVideo:AZn,fakeVideoDescription:CIn,featuredProductsEntity:Rup,flowStateEntity:zbd,iconBadgeEntity:VQn,interstitialInteractionStateEntity:s0d,likeButtonAnimationEntity:LAn,liveChatPollStateEntity:cZN,dataFreshnessEntity:ixd,liveViewerLeaderboardChatEntryPointStateEntity:gux,liveViewerLeaderboardPointsEntity:Oxh,liveReactionsDataEntity:NwU,logoEntity:GAN,macroMarkerEntity:SLU,
mainDownloadsLibraryEntity:vSp,mainDownloadsListEntity:KAA,mainPlaylistDownloadStateEntity:xoN,mainPlaylistEntity:T7h,mainPlaylistVideoEntity:IgX,mainVideoDownloadStateEntity:gSv,mainVideoEntity:YLU,markersEngagementPanelSyncEntity:doh,markersVisibilityOverrideEntity:VHz,musicAlbumReleaseDetail:qLv,musicAlbumReleaseDownloadMetadataEntity:Xrx,musicAlbumRelease:fgn,musicAlbumReleaseUserDetail:euX,musicArtistDetail:yvN,musicArtist:bRv,musicArtistUserDetail:oSU,musicDownloadsLibraryEntity:P$x,musicLibraryEdit:tHU,
musicLibraryStatusEntity:uWd,musicPlaylist:C$v,musicPlaylistDownloadMetadataEntity:Jvn,musicShare:zuz,musicTrackDetail:GFx,musicTrackDownloadMetadataEntity:lgh,musicTrack:HRd,musicTrackUserDetail:swA,offlineOrchestrationActionWrapperEntity:WAh,offlineVideoPolicy:B7h,offlineVideoStreams:ZRz,offlineabilityEntity:ORM,orchestrationWebSamplingEntity:rvU,pageHeaderEntity:Drn,pdpStateEntity:jXx,pinnedProductEntity:kFv,playbackData:vu1,playerStateEntity:jwU,quantityIncrementerEntity:mrU,refresh:FYx,saveToPlaylistListEntity:p_d,
selectedChipIndexEntityPayload:mox,settingEntity:QXN,stringEntity:btN,suggestedFeedbackChipStateEntity:huv,transfer:KYz,trendingOfferEntity:MHn,videoDownloadContextEntity:xrp,videoOverviewAsyncDataEntity:hZd,videoPlaybackPositionEntity:LYX,votingEntity:Eup,ytMainChannelEntity:wrN,youchatPendingResponseEntity:agX,ytMainDownloadedVideoEntity:prM,ytMainVideoEntity:N7N};g.d(uo,JKU);uo.prototype.D=function(v){return v};
uo.prototype.L=function(v){if(v instanceof Uint8Array)throw Urv(0);return v};
g.d(Ak,g.A);Ak.prototype.observe=function(v){var F=this;this.observers.push(v);return function(){var K=F.observers.indexOf(v);K>=0&&F.observers.splice(K,1)}};
Ak.prototype.L=function(v){WYU(this,v.data)};
Ak.prototype.Fx=function(){this.channel.close()};
var K9d,vIh=new g.fd("elementsCommand");var S1=new g.fd("entityBatchUpdate");var tqp=new g.fd("downloadStatusEntity");var xPX=new g.fd("mainPlaylistEntityActionMetadata");var CC=new g.fd("mainVideoEntityActionMetadata");var iGU=new g.fd("musicPlaylistEntityActionMetadata");var eXn=new g.fd("musicTrackEntityActionMetadata");var LMv=new g.fd("localImageEntityActionMetadata");var $m=new g.fd("playbackDataActionMetadata");var vdh=new g.fd("transferEntityActionMetadata");var yMN=new g.fd("videoPlaybackPositionEntityActionMetadata");var n4p;new g.iR;new g.iR;jVX.prototype.request=function(v,F,K){F=F===void 0?{}:F;return this.locks.request(v,F,function(x){return K(x)})};var Bi=g.jM.caches,Wi,k5n;ci.prototype.open=function(v){return Bi.open(a3v(v))};
ci.prototype.has=function(v){return Bi.has(a3v(v))};
ci.prototype.delete=function(v){return Bi.delete(a3v(v))};
ci.prototype.match=function(v,F){var K=this,x,O,r,p,T,I;return g.y(function(D){switch(D.W){case 1:return g.e(D,K.keys(),2);case 2:x=D.L,O=g.P(x),r=O.next();case 3:if(r.done){D.K5(5);break}p=r.value;return g.e(D,K.open(p),6);case 6:return T=D.L,g.e(D,T.match(v,F),7);case 7:if(I=D.L)return D.return(I);r=O.next();D.K5(3);break;case 5:return D.return()}})};
g.d(hlA,ci);hlA.prototype.keys=function(){var v,F,K,x,O,r,p,T,I;return g.y(function(D){if(D.W==1)return v=[],F=g.WJ("CacheStorage keys"),g.e(D,Bi.keys(),2);K=D.L;x=g.P(K);for(O=x.next();!O.done;O=x.next()){r=O.value;var E=r.indexOf(":");p=E===-1?{Ki:r}:{Ki:r.substring(0,E),datasyncId:r.substring(E+1)};T=p.Ki;I=p.datasyncId;I===F&&v.push(T)}return D.return(v)})};g.d(vG,g.A);vG.prototype.D=function(v){this.api.Vq("onOfflineOperationFailure",v.data)};
vG.prototype.G=function(v){this.api.publish("offlinetransferpause",v.data)};
vG.prototype.Fx=function(){var v;(v=this.W)==null||v.close();var F;(F=this.L)==null||F.close()};$xU.prototype.x5=function(){this.W&&KC(this)};
$xU.prototype.ut=function(){this.L&&this.L.resolve();this.D=this.W=!1;this.tP()};var NrU=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var W9n="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Q7X="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.d($Ep,km);$Ep.prototype.L=function(v){return rQ(v)?JMX(this,v):pC(v)?q1M(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.d(eyU,km);eyU.prototype.L=function(v){return pC(v)?bGx(this,v):o4N(v)?oIz(this,v):QW(v)?t9U(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.L=uCN.prototype;g.L.Seg=function(v){var F=this,K,x,O,r;return g.y(function(p){if(!g.c(v.state,128))return p.K5(0);K=v.state.EG;var T=(x=K)==null?void 0:x.errorCode,I=(O=K)==null?void 0:O.T0;r=T==="net.connect"&&I===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(T==null?0:T.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.e(p,F.GM(F.player.getVideoData().videoId,r),0)})};
g.L.GM=function(v,F){var K=this;return g.y(function(x){if(x.W==1){if(K.L)return x.return();K.L=!0;return F==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Ju(K,v,!1,!0),x.K5(0)):g.e(x,PG(K,v),3)}g.C$(v,4);return g.e(x,K.W.GM(F),0)})};
g.L.I1=function(v){v.status===2?(v.status!==this.D&&(egX(this.W),g.C$(v.videoId,2)),v.Tk&&ump(this.W,v.videoId,v.Tk)):v.status===4?(PG(this,v.videoId),this.GM(v.videoId,v.U2?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):v.status===1&&tm1(this.W);this.D=v.status;this.api.Vq("localmediachange",{videoId:v.videoId,status:v.status})};
g.L.Z3=function(){var v=this,F;return g.y(function(K){if(K.W==1){if(v.L)return K.return();v.L=!0;F=v.player.getVideoData().videoId;return g.e(K,PG(v,F),2)}return g.e(K,v.W.Z3(),0)})};
g.L.P3=function(v){switch(v){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.L.S=function(v){return this.api.U().S(v)};g.d(s7d,km);s7d.prototype.L=function(v){return rQ(v)?WsN(this,v):pC(v)?Bvp(this,v):o4N(v)?ZGn(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};O81.prototype.W=function(v,F){var K=v.action.actionMetadata.priority-F.action.actionMetadata.priority;K===0&&(v.W<F.W?K=-1:v.W>F.W&&(K=1));return K};g.d(lV,g.A);lV.prototype.Fx=function(){this.tP&&this.tP();g.A.prototype.Fx.call(this)};
lV.prototype.createAction=function(v,F){var K=g.CY(v.entityKey).entityType,x=g.nX(16);return new iV(K,x,v,F.actionId,F.rootActionId)};
lV.prototype.L5=function(v){var F=this,K,x,O,r,p,T,I,D,E;return g.y(function(Y){if(Y.W==1){if(F.jC())return Y.return();x=(K=v.offlineOrchestrationActionWrapperEntity)!=null?K:new Set;O=[];r=g.P(x);for(p=r.next();!p.done;p=r.next())T=p.value,I=g.CY(T),D=I.entityId,Qo1(F.W,D)||O.push(T);return g.e(Y,SYv(F,O),2)}E=Y.L;return g.e(Y,L7A(F,E),0)})};
lV.prototype.retry=function(){var v=this;return g.y(function(F){return g.e(F,dGp(v),0)})};joA.prototype.x6=function(v,F){F=F===void 0?!0:F;var K=this,x,O,r,p,T,I,D,E;return g.y(function(Y){switch(Y.W){case 1:if(!K.W)return Y.return();x=[];O=g.CU(K.W.W,F);r=[];for(p={Bm:0};p.Bm<O.length;p={Bm:p.Bm},p.Bm++)T=O[p.Bm],I=K.W.hh(T,"json3"),D=g.qC(I,{withCredentials:!0,format:"RAW"},3,500).then(function(N){return function(w){w={metadata:g.k_(O[N.Bm]),trackData:w.xhr.responseText};r.push(w)}}(p)).tF(function(N){ZE("Caption fetch error",N)}),x.push(D);
return g.e(Y,JZd(x),2);case 2:return g.pp(Y,3),g.e(Y,I3d(v,r),5);case 5:g.Ix(Y,0);break;case 3:E=g.DX(Y),ZE("Caption DB transaction error",E),g.rd(Y)}})};g.d(fC,g.A);fC.prototype.Fx=function(){this.L&&this.L();g.A.prototype.Fx.call(this)};
fC.prototype.D=function(v){var F=this,K,x,O,r,p,T,I,D;return g.y(function(E){x=(K=v.transfer)!=null?K:new Set;O=[];r=g.P(x);for(p=r.next();!p.done;p=r.next())T=p.value,I=g.CY(T),D=I.entityId,O.push(D);return O.length===0?E.return():g.e(E,aYz(F,O),0)})};g.d($GX,g.A);g.L=$GX.prototype;g.L.Fx=function(){this.f5&&this.f5();this.C5.dispose();this.G.dispose();this.SC&&g.p8(this.j.b_,this.SC);this.Zg&&g.p8(this.j.b_,this.Zg);g.A.prototype.Fx.call(this)};
g.L.QvP=function(v){var F=this,K,x,O;return g.y(function(r){switch(r.W){case 1:K=g.zc(v,"transfer");if(F.W&&K===F.W.key){Ju(F.X,F.C,!0);F.G.stop();r.K5(0);break}return g.e(r,CA(F.L,{mode:"readwrite",X$:!0},function(p){return ek(p,K,"transfer").then(function(T){if(T&&T.transferState!=="TRANSFER_STATE_COMPLETE"&&T.transferState!=="TRANSFER_STATE_FAILED")return T.transferState="TRANSFER_STATE_PAUSED_BY_USER",o3(p,T,"transfer").then(function(){return T})})}),3);
case 3:x=r.L;if(!x){r.K5(0);break}if(!v||!F.D){r.K5(5);break}return g.e(r,Tb(v,F.D,F.L,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.e(r,bV(F,v),7);case 7:O=r.L,b_x({videoId:v,Eq:x,offlineModeType:O}),g.rd(r)}})};
g.L.LEE=function(){var v=this;if(this.W&&this.C){Ju(this.X,this.C,!1);var F=this.W,K=(F==null?0:F.key)?g.CY(F.key).entityId:"";K&&this.D&&(new Promise(function(x,O){Tb(K,v.D,v.L,"DOWNLOAD_STATE_PAUSED").catch(function(r){O(r)})})).catch(function(x){ZE("Download state setting error",x)})}this.G.stop()};
g.L.Ei=function(){this.W?JXN(this,this.W):e1(this)};
g.L.Ws=function(v){var F=this;return g.y(function(K){switch(K.W){case 1:if(!F.W){K.K5(2);break}if(F.W.transferState==="TRANSFER_STATE_COMPLETE"||F.W.transferState==="TRANSFER_STATE_FAILED"||!v.transfer||!v.transfer.has(F.W.key)){K.K5(3);break}return g.e(K,Hi(F.L,F.W.key,"transfer"),4);case 4:F.W=K.L;if(F.W){K.K5(3);break}return g.e(K,lYU(F),3);case 3:if(F.W)return K.return();case 2:return g.e(K,e1(F),0)}})};
g.L.GM=function(v,F){var K=this,x,O,r,p,T;return g.y(function(I){switch(I.W){case 1:if(!K.W){yW(K,"onTransferFailure: "+v);I.K5(2);break}x=K.W;r=((O=x)==null?0:O.key)?g.CY(x.key).entityId:"";a:switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var D=!1;break a;default:D=!0}return D&&AXz(K)?g.e(I,oJ(K,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.e(I,
CPv(K,v),5);case 5:if(!r||!K.D){I.K5(2);break}return g.e(I,Tb(r,K.D,K.L,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.e(I,bV(K,r),9);case 9:p=I.L;gQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:r,Eq:x,offlineModeType:p});if(!r||!K.D){I.K5(2);break}return g.e(I,Tb(r,K.D,K.L,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:qb(K),T=e1(K,!0),F&&F(T),g.rd(I)}})};
g.L.Z3=function(v){var F=this,K,x,O,r,p,T,I,D,E,Y,N,w;return g.y(function(n){switch(n.W){case 1:if(!F.W){yW(F,"onMaybeTransferStreamsExpired");n.K5(2);break}return AXz(F)?g.e(n,oJ(F,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.e(n,CPv(F,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!F.D){n.K5(2);break}K=F.W;O=((x=K)==null?0:x.key)?g.CY(K.key).entityId:"";if(!O){n.K5(2);break}return g.e(n,Tb(O,F.D,F.L,"DOWNLOAD_STATE_FAILED"),2);case 9:return F.W||yW(F,"onMaybeTransferStreamsExpiredRetryAttempting"),
r=F.W,T=((p=r)==null?0:p.key)?g.CY(r.key).entityId:"",g.e(n,bV(F,T),10);case 10:return I=n.L,gQ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:T,Eq:r,offlineModeType:I}),D=CmA(),g.qL(D,$m,{isEnqueuedForExpiredStreamUrlRefetch:!0}),E=g.zc(T,"playbackData"),Y={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:E,actionMetadata:D},N=wQ(new iV("playbackData",T,Y)),g.e(n,zR(F.L,N,"offlineOrchestrationActionWrapperEntity"),2);case 2:qb(F),w=e1(F,!0),
v&&v(w),g.rd(n)}})};
var slX={},zgX=(slX.TRANSFER_STATE_TRANSFERRING=1,slX.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,slX);g.L=tu.prototype;g.L.bG=function(){return this.C.promise};
g.L.sZ=function(){if(this.L&&this.X)return this.C.promise;soh(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.L.aX=function(v){var F={};return F.playbackData=new $Ep(v,this.N,this.W),F.transfer=new s7d(v,this.N),F.videoPlaybackPositionEntity=new eyU(v,this.N),F};
g.L.Wh=function(){var v=this;return g.y(function(F){return v.L?g.e(F,XPA(v.L),0):F.K5(0)})};
g.L.UZ=function(){var v=this,F,K;return g.y(function(x){if(x.W==1)return v.L||v.X?g.e(x,v.bG(),2):x.return();v.T!==void 0&&(g.aa(v.T),v.T=void 0);v.G!==void 0&&(g.aa(v.G),v.G=void 0);(F=v.L)==null||F.dispose();v.L=void 0;(K=v.X)==null||K.dispose();v.X=void 0;v.api.Vq("onOrchestrationLostLeader");v.C=new g.iR;g.rd(x)})};
g.L.isOrchestrationLeader=function(){return this.D.W};
g.L.NA=function(){return g.y(function(v){return v.return(!1)})};
g.L.Fk=function(v){var F=this.W;F.api.publish("offlinetransferpause",v);var K;(K=F.L)==null||K.postMessage(v)};
g.L.Ei=function(v){var F,K;return g.y(function(x){if(x.W==1)return g.e(x,sC(),2);F=x.L;if(!F)return x.return();K=g.zc(v,"transfer");return g.e(x,CA(F,{mode:"readwrite",X$:!0},function(O){var r=ek(O,K,"transfer"),p=ek(O,g.zc(v,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.mK.all([r,p]).then(function(T){T=g.P(T);var I=T.next().value;var D=T.next().value;return I&&I.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(I.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",o3(O,I,"transfer").then(function(){gQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:v,Eq:I,offlineModeType:D==null?void 0:D.offlineModeType});return g.mK.resolve(null)})):g.mK.resolve(null)})}),0)})};
g.L.g0=function(v){v=v===void 0?43200:v;var F=this,K,x,O,r,p,T,I,D;return g.y(function(E){if(E.W==1)return F.j.C7()?g.e(E,sC(),2):E.return(cXx());if(E.W!=3){K=E.L;if(!K)return E.return([]);x=Date.now()/1E3;return g.e(E,GR(K,"offlineVideoPolicy"),3)}O=E.L;r=[];p=g.P(O);for(T=p.next();!T.done;T=p.next())I=T.value,Number(I.lastUpdatedTimestampSeconds)+v<=x&&(D=g.CY(I.key).entityId,r.push(D));return r.length?E.return(uV(F,r,F.tP,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):E.return([])})};
g.L.deleteAll=function(){return uV(this,["!*$_ALL_ENTITIES_!*$"],this.tP,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.L.refreshAllStaleEntities=function(v){var F=this;return g.y(function(K){return K.W==1?g.e(K,F.g0(v),2):K.return(K.L)})};
g.L.setUpPositionSyncInterval=function(v){var F=this;this.G!==void 0&&(g.aa(this.G),this.G=void 0);var K=v!=null?v:864E5;this.G=g.m_(function(){F.HW(K)},K)};
g.L.HW=function(v){var F=this,K,x,O,r,p,T;return g.y(function(I){switch(I.W){case 1:return g.pp(I,2),g.e(I,lo.getInstance(),4);case 4:K=I.L;if(!K)throw Error("prefStorage is undefined");return g.e(I,K.get("psi"),5);case 5:x=I.L;r=((O=x)==null?0:O.w2)?Number(x.w2)/1E3:0;p=Date.now();if(!(r+v<=p)){I.K5(6);break}return g.e(I,uV(F,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Ix(I,0);break;case 2:T=g.DX(I),ZE("Offline manager error",T),
g.rd(I)}})};
g.L.N6=function(){var v=this,F,K,x,O,r,p,T;return g.y(function(I){if(I.W==1)return g.e(I,sC(),2);if(I.W!=3)return(F=I.L)?g.e(I,GR(F,"transfer"),3):I.return([]);K=I.L;x=[];O=g.P(K);for(r=O.next();!r.done;r=O.next())p=r.value,p.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&p.key&&(T=g.CY(p.key).entityId,x.push(T));return I.return(BrU(v,x))})};
g.L.KE=function(){return g.y(function(v){return v.return([])})};
g.L.ek=function(){return g.y(function(v){g.rd(v)})};
g.L.rF=function(){return g.y(function(v){g.rd(v)})};g.d(Z8X,km);Z8X.prototype.L=function(v){return rQ(v)?KMv(this,v):pC(v)?gyX(this,v):QW(v)?OTh(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var Au=[10];g.d(Iwz,km);Iwz.prototype.L=function(v){return rQ(v)?iTz(this,v):pC(v)?YhA(this,v):QW(v)?wQd(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var EyX=[10];g.d(nyv,km);nyv.prototype.L=function(v){return pC(v)?ShM(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.d(dPz,tu);g.L=dPz.prototype;g.L.aX=function(v){var F=tu.prototype.aX.call(this,v);F.mainVideoEntity=new Iwz(v,this.N,this.W);F.mainPlaylistEntity=new Z8X(v,this.N,this.W);F.mainDownloadsListEntity=new nyv(v,this.N,this.W);return F};
g.L.refreshAllStaleEntities=function(v,F){var K=this,x,O,r,p,T,I,D,E,Y,N,w;return g.y(function(n){switch(n.W){case 1:x=[];if(!K.N.S("web_player_offline_playlist_auto_refresh")){n.K5(2);break}return g.e(n,VfA(K,v,F),3);case 3:x=n.L;case 2:return g.e(n,lo.getInstance(),4);case 4:return O=n.L,g.e(n,(r=O)==null?void 0:r.get("sdois"),5);case 5:return p=n.L,g.e(n,(T=O)==null?void 0:T.get("lmqf"),6);case 6:I=n.L;if(!p){n.K5(7);break}E=x;Y=E.concat;return g.e(n,jlp(K,p,(D=I)!=null?D:"SD",v===0),8);case 8:x=
Y.call(E,n.L);case 7:return N=x,w=N.concat,g.e(n,tu.prototype.refreshAllStaleEntities.call(K,v,F),9);case 9:return x=w.call(N,n.L),n.return(x)}})};
g.L.NA=function(v){var F,K,x,O,r,p,T,I;return g.y(function(D){if(D.W==1)return g.e(D,sC(),2);if(D.W!=3)return(F=D.L)?g.e(D,Hi(F,g.$J,"mainDownloadsListEntity"),3):D.return(!1);K=D.L;if((x=K)==null?0:(O=x.downloads)==null?0:O.length)for(r=g.zc(v,"mainVideoEntity"),p=g.P(K.downloads),T=p.next();!T.done;T=p.next())if(I=T.value,I.videoItem===r)return D.return(!0);return D.return(!1)})};
g.L.KE=function(){var v=this,F,K,x,O,r,p,T,I;return g.y(function(D){if(D.W==1)return g.e(D,sC(),2);if(D.W!=3)return(F=D.L)?g.e(D,GR(F,"downloadStatusEntity"),3):D.return([]);K=D.L;x=[];O=g.P(K);for(r=O.next();!r.done;r=O.next())p=r.value,p.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&p.key&&(T=g.CY(p.key).entityId,x.push(T));return x.length?(I={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},D.return(uV(v,x,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
I))):D.return([])})};
g.L.rF=function(){var v;return g.y(function(F){return F.W==1?g.e(F,sC(),2):(v=F.L)?g.e(F,CA(v,{mode:"readwrite",X$:!0},function(K){return bo(K,"mainVideoEntity").then(function(x){var O=[];x=g.P(x);for(var r=x.next();!r.done;r=x.next()){r=r.value;var p=void 0;(p=r.userState)!=null&&p.playbackPosition||(p=g.CY(r.key).entityId,p={key:g.zc(p,"videoPlaybackPositionEntity"),videoId:p,lastPlaybackPositionSeconds:"0"},O.push(o3(K,p,"videoPlaybackPositionEntity")),r.userState={playbackPosition:p.key},O.push(o3(K,
r,"mainVideoEntity")))}return g.mK.all(O)})}),0):F.return()})};
g.L.ek=function(){var v,F,K,x,O,r,p,T,I,D,E,Y,N,w,n,V,h,X,M,J,f,u,t,g_,F_,xe,QA,iU,KE,jU,B5,QU,or,W5,qQ,Wn,Pn,U;return g.y(function(FQ){if(FQ.W==1)return g.e(FQ,sC(),2);if(FQ.W!=3){v=FQ.L;if(!v)return FQ.return();F=g.zc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.e(FQ,CA(v,{mode:"readonly",X$:!0},function(Gh){return g.mK.all([ek(Gh,F,"mainDownloadsListEntity"),ek(Gh,g.$J,"mainDownloadsListEntity"),bo(Gh,"mainVideoEntity"),bo(Gh,"mainPlaylistEntity")])}),3)}K=FQ.L;
x=g.P(K);O=x.next().value;r=x.next().value;p=x.next().value;T=x.next().value;I=O;D=r;E=p;Y=T;N=new Set;if((w=I)==null?0:(n=w.downloads)==null?0:n.length)for(V=g.P(I.downloads),h=V.next();!h.done;h=V.next())X=h.value,M=void 0,(J=(M=X.videoItem)!=null?M:X.playlistItem)&&N.add(J);if((f=D)==null?0:(u=f.downloads)==null?0:u.length)for(t=g.P(D.downloads),g_=t.next();!g_.done;g_=t.next())F_=g_.value,F_.videoItem&&N.add(F_.videoItem);xe=new Set;QA=[];iU=g.P(Y);for(KE=iU.next();!KE.done;KE=iU.next()){jU=KE.value;
if(jU.videos)for(B5=g.P(jU.videos),QU=B5.next();!QU.done;QU=B5.next())or=QU.value,(W5=JSON.parse(g.CY(or).entityId).videoId)&&xe.add(W5);jU.key&&!N.has(jU.key)&&QA.push(jU.key)}qQ=g.P(E);for(Wn=qQ.next();!Wn.done;Wn=qQ.next())Pn=Wn.value,Pn.key&&!N.has(Pn.key)&&(U=g.CY(Pn.key).entityId,xe.has(U)||QA.push(Pn.key));return QA.length?g.e(FQ,gIX(v,QA),0):FQ.K5(0)})};g.d(mPX,km);mPX.prototype.L=function(v){return rQ(v)?awN(this,v):pC(v)?RXd(this,v):QW(v)?kIp(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var zb=[10];g.d(UPn,km);UPn.prototype.L=function(v){return rQ(v)?XQz(this,v):pC(v)?PRh(this,v):QW(v)?JpM(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var HG=[10];g.d(qhN,km);qhN.prototype.L=function(v){return rQ(v)?oyU(this,v):pC(v)?tfA(this,v):QW(v)?udn(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var yph=[10];g.d(Gb,tu);Gb.prototype.aX=function(v){var F=tu.prototype.aX.call(this,v);F.musicTrack=new qhN(v,this.W);F.musicPlaylist=new UPn(v,this.W);F.musicAlbumRelease=new mPX(v,this.W);return F};
Gb.prototype.refreshAllStaleEntities=function(v,F){var K=this,x,O,r;return g.y(function(p){if(p.W==1)return g.e(p,CRA(K,v,F),2);if(p.W!=3)return O=x=p.L,r=O.concat,g.e(p,tu.prototype.refreshAllStaleEntities.call(K,v,F),3);x=r.call(O,p.L);return p.return(x)})};g.d(zXU,g.DN);g.L=zXU.prototype;g.L.create=function(){var v=this;g.C(this,this.events);if(g.p$(this.N))this.W=new dPz(this.N,this.player);else if(g.ec(this.N)||g.TT(this.N))this.W=new Gb(this.N,this.player);this.events.B(this.player,"onPlaybackStartExternal",function(){v.PZ()});
this.events.B(this.player,"videodatachange",function(){v.PZ()});
this.N.S("html5_offline_playback_position_sync")&&this.events.B(this.player,"presentingplayerstatechange",this.C1)};
g.L.eJ=function(){return!1};
g.L.b0=function(v,F,K,x){var O=this;return g.y(function(r){return O.W?r.return(uV(O.W,v,F,K,x)):r.return(Promise.reject())})};
g.L.deleteAll=function(){return this.W.deleteAll()};
g.L.g0=function(v){return this.W.g0(v)};
g.L.refreshAllStaleEntities=function(v){return this.W.refreshAllStaleEntities(v)};
g.L.setUpPositionSyncInterval=function(v){this.W.setUpPositionSyncInterval(v)};
g.L.Fk=function(v){this.W.Fk(v)};
g.L.Ei=function(v){return this.W.Ei(v)};
g.L.PZ=function(){var v=this,F;return g.y(function(K){F=v.player.getVideoData();return g.Od(F)?HTn(F)&&v.L!==F.clientPlaybackNonce?g.e(K,GIx(v,F),0):K.K5(0):K.return()})};
g.L.C1=function(v){var F=this,K,x,O,r,p,T,I;return g.y(function(D){if(D.W==1)return K=F.player.getVideoData(),x=K.j3,g.Y5(v,2)||g.Y5(v,512)?g.e(D,sC(),2):D.return();if(D.W!=3){O=D.L;if(!O)return ZE("PES is undefined"),D.return();r=K.videoId;return g.e(D,Hi(O,g.zc(r,"mainVideoEntity"),"mainVideoEntity"),3)}p=D.L;if(!p)return D.return();T=Math.floor(x).toString();I={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:T}};return g.e(D,F.b0([r],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
I),0)})};
g.L.isOrchestrationLeader=function(){return this.W.isOrchestrationLeader()};
g.L.updateDownloadState=function(v,F){var K,x,O,r;return g.y(function(p){if(p.W==1)return g.e(p,sC(),2);K=p.L;if(!K)return ZE("PES is undefined"),p.return();x=g.CY(v);O=x.entityType;r=x.entityId;return g.e(p,Tb(r,O,K,F,!0),0)})};g.IH("offline",zXU);})(_yt_player);
